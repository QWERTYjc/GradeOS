# äº¤äº’æµç¨‹

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [main.py](file://ai_correction/main.py)
- [UI_OPTIMIZATION_SUMMARY.md](file://ai_correction/docs/UI_OPTIMIZATION_SUMMARY.md)
- [workflow_multimodal.py](file://ai_correction/functions/langgraph/workflow_multimodal.py)
- [state.py](file://ai_correction/functions/langgraph/state.py)
- [streaming.py](file://ai_correction/functions/langgraph/streaming.py)
- [langgraph_integration.py](file://ai_correction/functions/langgraph_integration.py)
- [simple_ui_helper.py](file://ai_correction/functions/langgraph/simple_ui_helper.py)
- [workflow_simplified.py](file://ai_correction/functions/langgraph/workflow_simplified.py)
- [test_new_workflow.py](file://ai_correction/test_new_workflow.py)
- [local_runner.py](file://ai_correction/local_runner.py)
- [upload_validator.py](file://ai_correction/functions/langgraph/agents/upload_validator.py)
</cite>

## ç›®å½•
1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [ç”¨æˆ·ç™»å½•æµç¨‹](#ç”¨æˆ·ç™»å½•æµç¨‹)
3. [æ–‡ä»¶ä¸Šä¼ ä¸å‚æ•°é…ç½®](#æ–‡ä»¶ä¸Šä¼ ä¸å‚æ•°é…ç½®)
4. [æ‰¹æ”¹ä»»åŠ¡è§¦å‘æœºåˆ¶](#æ‰¹æ”¹ä»»åŠ¡è§¦å‘æœºåˆ¶)
5. [Streamlitå‰ç«¯ä¸LangGraphåç«¯é€šä¿¡](#streamlitå‰ç«¯ä¸langgraphåç«¯é€šä¿¡)
6. [çŠ¶æ€ç®¡ç†ç³»ç»Ÿ](#çŠ¶æ€ç®¡ç†ç³»ç»Ÿ)
7. [å¼‚æ­¥ä»»åŠ¡å¤„ç†](#å¼‚æ­¥ä»»åŠ¡å¤„ç†)
8. [ç»“æœå±•ç¤ºä¸äº¤äº’](#ç»“æœå±•ç¤ºä¸äº¤äº’)
9. [é”™è¯¯å¤„ç†ä¸æ•…éšœæ’é™¤](#é”™è¯¯å¤„ç†ä¸æ•…éšœæ’é™¤)
10. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)

## ç³»ç»Ÿæ¦‚è¿°

AIæ™ºèƒ½æ‰¹æ”¹ç³»ç»Ÿé‡‡ç”¨ç°ä»£åŒ–çš„å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œå‰ç«¯åŸºäºStreamlitæ„å»ºç®€æ´ç›´è§‚çš„ç”¨æˆ·ç•Œé¢ï¼Œåç«¯ä½¿ç”¨LangGraphå®ç°é«˜æ•ˆçš„å¤šAgentåä½œå·¥ä½œæµã€‚ç³»ç»Ÿçš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºç®€åŒ–äº†ç”¨æˆ·æ“ä½œæµç¨‹ï¼Œåˆ é™¤äº†å†—ä½™çš„æ¨¡å¼é€‰æ‹©æ­¥éª¤ï¼Œå®ç°äº†ä»æ–‡ä»¶ä¸Šä¼ åˆ°ç»“æœå±•ç¤ºçš„ä¸€ç«™å¼æ‰¹æ”¹ä½“éªŒã€‚

```mermaid
graph TB
subgraph "å‰ç«¯å±‚ (Streamlit)"
UI[ç”¨æˆ·ç•Œé¢]
Session[ä¼šè¯çŠ¶æ€ç®¡ç†]
Upload[æ–‡ä»¶ä¸Šä¼ ç»„ä»¶]
Progress[è¿›åº¦æ˜¾ç¤ºç»„ä»¶]
end
subgraph "åç«¯å±‚ (LangGraph)"
Workflow[å¤šæ¨¡æ€å·¥ä½œæµ]
Agents[8ä¸ªåä½œAgent]
State[çŠ¶æ€ç®¡ç†]
Streaming[æµå¼å¤„ç†]
end
subgraph "æ•°æ®å±‚"
Files[æ–‡ä»¶å­˜å‚¨]
Cache[ç¼“å­˜ç³»ç»Ÿ]
Results[ç»“æœå­˜å‚¨]
end
UI --> Session
Session --> Upload
Upload --> Workflow
Workflow --> Agents
Agents --> State
State --> Streaming
Streaming --> Progress
Progress --> UI
Workflow --> Files
Workflow --> Cache
Workflow --> Results
```

**å›¾è¡¨æ¥æº**
- [main.py](file://ai_correction/main.py#L1-L100)
- [workflow_multimodal.py](file://ai_correction/functions/langgraph/workflow_multimodal.py#L1-L50)

## ç”¨æˆ·ç™»å½•æµç¨‹

ç³»ç»Ÿé‡‡ç”¨ç®€åŒ–çš„ç™»å½•æœºåˆ¶ï¼Œæ”¯æŒæ¼”ç¤ºè´¦æˆ·å’Œæ­£å¼ç”¨æˆ·ä¸¤ç§ç™»å½•æ–¹å¼ã€‚ç™»å½•æµç¨‹ç»è¿‡ä¼˜åŒ–ï¼Œå‡å°‘äº†ä¼ ç»Ÿç³»ç»Ÿçš„å¤æ‚è®¤è¯æ­¥éª¤ã€‚

### ç™»å½•ç•Œé¢è®¾è®¡

```mermaid
sequenceDiagram
participant User as ç”¨æˆ·
participant UI as Streamlitç•Œé¢
participant Auth as è®¤è¯æ¨¡å—
participant Session as ä¼šè¯çŠ¶æ€
User->>UI : è®¿é—®ç³»ç»Ÿ
UI->>UI : æ˜¾ç¤ºç™»å½•é¡µé¢
User->>UI : è¾“å…¥ç”¨æˆ·å/å¯†ç 
UI->>Auth : éªŒè¯å‡­æ®
Auth->>Auth : SHA256å“ˆå¸ŒéªŒè¯
Auth->>Session : è®¾ç½®ç™»å½•çŠ¶æ€
Session->>UI : æ›´æ–°é¡µé¢çŠ¶æ€
UI->>User : è·³è½¬åˆ°æ‰¹æ”¹é¡µé¢
```

**å›¾è¡¨æ¥æº**
- [main.py](file://ai_correction/main.py#L520-L580)

### ç™»å½•çŠ¶æ€ç®¡ç†

ç³»ç»Ÿä½¿ç”¨`st.session_state`ç»´æŠ¤ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œç¡®ä¿ç”¨æˆ·åœ¨æ•´ä¸ªæ‰¹æ”¹æµç¨‹ä¸­çš„èº«ä»½ä¸€è‡´æ€§ï¼š

| çŠ¶æ€å­—æ®µ | ç±»å‹ | æè¿° | é»˜è®¤å€¼ |
|---------|------|------|--------|
| `logged_in` | bool | ç™»å½•çŠ¶æ€æ ‡å¿— | False |
| `username` | str | ç”¨æˆ·å | "" |
| `page` | str | å½“å‰é¡µé¢ | "home" |
| `current_task_id` | str | å½“å‰ä»»åŠ¡ID | None |

**ç« èŠ‚æ¥æº**
- [main.py](file://ai_correction/main.py#L423-L428)

## æ–‡ä»¶ä¸Šä¼ ä¸å‚æ•°é…ç½®

ç³»ç»Ÿç®€åŒ–äº†ä¼ ç»Ÿçš„ä¸‰æ–‡ä»¶ä¸Šä¼ æµç¨‹ï¼Œé‡‡ç”¨ç»Ÿä¸€çš„æ–‡ä»¶é€‰æ‹©å™¨ï¼Œæ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼çš„æ‰¹é‡ä¸Šä¼ ã€‚ç”¨æˆ·æ— éœ€æ‰‹åŠ¨åŒºåˆ†é¢˜ç›®ã€ç­”æ¡ˆå’Œè¯„åˆ†æ ‡å‡†æ–‡ä»¶ã€‚

### æ”¯æŒçš„æ–‡ä»¶æ ¼å¼

| æ–‡ä»¶ç±»å‹ | æ”¯æŒæ ¼å¼ | æœ€å¤§æ–‡ä»¶å¤§å° | éªŒè¯è¦æ±‚ |
|---------|----------|-------------|----------|
| å›¾åƒæ–‡ä»¶ | JPG, JPEG, PNG, BMP, WebP | 10MB | å°ºå¯¸æ£€æŸ¥ã€æ ¼å¼éªŒè¯ |
| æ–‡æœ¬æ–‡æ¡£ | TXT, MD | 10MB | ç¼–ç æ£€æµ‹ã€å†…å®¹éªŒè¯ |
| PDFæ–‡ä»¶ | PDF | 10MB | æ ¼å¼éªŒè¯ |
| Wordæ–‡æ¡£ | DOC, DOCX | 10MB | æ ¼å¼éªŒè¯ |

### æ–‡ä»¶ä¸Šä¼ æµç¨‹

```mermaid
flowchart TD
Start([å¼€å§‹ä¸Šä¼ ]) --> ValidateFormat["éªŒè¯æ–‡ä»¶æ ¼å¼"]
ValidateFormat --> FormatOK{"æ ¼å¼æ­£ç¡®?"}
FormatOK --> |å¦| ShowError["æ˜¾ç¤ºæ ¼å¼é”™è¯¯"]
FormatOK --> |æ˜¯| ValidateSize["éªŒè¯æ–‡ä»¶å¤§å°"]
ValidateSize --> SizeOK{"å¤§å°åˆé€‚?"}
SizeOK --> |å¦| ShowSizeError["æ˜¾ç¤ºå¤§å°é”™è¯¯"]
SizeOK --> |æ˜¯| SaveFile["ä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°"]
SaveFile --> UpdateState["æ›´æ–°ä¼šè¯çŠ¶æ€"]
UpdateState --> Ready["å‡†å¤‡å°±ç»ª"]
ShowError --> End([ç»“æŸ])
ShowSizeError --> End
Ready --> End
```

**å›¾è¡¨æ¥æº**
- [upload_validator.py](file://ai_correction/functions/langgraph/agents/upload_validator.py#L84-L122)

### å‚æ•°é…ç½®ç•Œé¢

ç³»ç»Ÿæä¾›ç®€æ´çš„å‚æ•°é…ç½®é€‰é¡¹ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸¥æ ¼ç¨‹åº¦å’Œè¯­è¨€è®¾ç½®ï¼š

| å‚æ•° | å¯é€‰å€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|--------|------|
| ä¸¥æ ¼ç¨‹åº¦ | å®½æ¾/ä¸­ç­‰/ä¸¥æ ¼ | ä¸­ç­‰ | å½±å“è¯„åˆ†æ ‡å‡†çš„æ‰§è¡ŒåŠ›åº¦ |
| è¯­è¨€ | zh/en | zh | ç³»ç»Ÿå’Œæ‰¹æ”¹ç»“æœçš„è¯­è¨€ |

**ç« èŠ‚æ¥æº**
- [main.py](file://ai_correction/main.py#L630-L650)

## æ‰¹æ”¹ä»»åŠ¡è§¦å‘æœºåˆ¶

ç³»ç»Ÿé‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„æ‰¹æ”¹ä»»åŠ¡è§¦å‘æœºåˆ¶ï¼Œå½“ç”¨æˆ·ç‚¹å‡»"ç«‹å³æ‰¹æ”¹"æŒ‰é’®æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ”¶é›†ä¸Šä¼ çš„æ–‡ä»¶å’Œé…ç½®å‚æ•°ï¼Œç„¶åå¯åŠ¨å¼‚æ­¥æ‰¹æ”¹ä»»åŠ¡ã€‚

### ä»»åŠ¡è§¦å‘æµç¨‹

```mermaid
sequenceDiagram
participant User as ç”¨æˆ·
participant Button as æ‰¹æ”¹æŒ‰é’®
participant Session as ä¼šè¯çŠ¶æ€
participant Integration as LangGraphé›†æˆ
participant Workflow as å·¥ä½œæµå¼•æ“
User->>Button : ç‚¹å‡»"ç«‹å³æ‰¹æ”¹"
Button->>Session : æ£€æŸ¥ç™»å½•çŠ¶æ€
Session->>Session : éªŒè¯æ–‡ä»¶ä¸Šä¼ 
Session->>Integration : å¯åŠ¨æ‰¹æ”¹ä»»åŠ¡
Integration->>Integration : ç”Ÿæˆä»»åŠ¡ID
Integration->>Workflow : æäº¤æ‰¹æ”¹è¯·æ±‚
Workflow->>Workflow : åˆå§‹åŒ–å·¥ä½œæµçŠ¶æ€
Workflow-->>Integration : è¿”å›ä»»åŠ¡çŠ¶æ€
Integration-->>Session : æ›´æ–°ä»»åŠ¡ä¿¡æ¯
Session-->>User : æ˜¾ç¤ºè¿›åº¦æ¡
```

**å›¾è¡¨æ¥æº**
- [main.py](file://ai_correction/main.py#L630-L650)
- [langgraph_integration.py](file://ai_correction/functions/langgraph_integration.py#L30-L80)

### ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª

ç³»ç»Ÿç»´æŠ¤è¯¦ç»†çš„æ‰¹æ”¹ä»»åŠ¡çŠ¶æ€ï¼ŒåŒ…æ‹¬è¿›åº¦ç™¾åˆ†æ¯”ã€å½“å‰æ­¥éª¤å’Œé”™è¯¯ä¿¡æ¯ï¼š

| çŠ¶æ€å­—æ®µ | ç±»å‹ | æè¿° | æ›´æ–°æ—¶æœº |
|---------|------|------|----------|
| `current_step` | str | å½“å‰å¤„ç†æ­¥éª¤ | æ¯ä¸ªAgentå®Œæˆåæ›´æ–° |
| `progress_percentage` | float | è¿›åº¦ç™¾åˆ†æ¯” | å®æ—¶æ›´æ–° |
| `completion_status` | str | å®ŒæˆçŠ¶æ€ | ä»»åŠ¡å¼€å§‹ã€å®Œæˆæˆ–å¤±è´¥æ—¶ |
| `errors` | list | é”™è¯¯ä¿¡æ¯åˆ—è¡¨ | å‘ç”Ÿé”™è¯¯æ—¶è¿½åŠ  |

**ç« èŠ‚æ¥æº**
- [state.py](file://ai_correction/functions/langgraph/state.py#L240-L260)

## Streamlitå‰ç«¯ä¸LangGraphåç«¯é€šä¿¡

ç³»ç»Ÿé‡‡ç”¨å¼‚æ­¥é€šä¿¡æœºåˆ¶ï¼Œå‰ç«¯é€šè¿‡WebSocketæˆ–è½®è¯¢æ–¹å¼å®æ—¶è·å–åç«¯çš„æ‰¹æ”¹è¿›åº¦å’Œç»“æœã€‚è¿™ç§è®¾è®¡ç¡®ä¿äº†ç”¨æˆ·ç•Œé¢çš„å“åº”æ€§å’Œå®æ—¶æ€§ã€‚

### é€šä¿¡æ¶æ„

```mermaid
graph LR
subgraph "Streamlitå‰ç«¯"
UI[ç”¨æˆ·ç•Œé¢]
WS[WebSocketè¿æ¥]
Poll[è½®è¯¢æœºåˆ¶]
end
subgraph "ä¸­é—´ä»¶å±‚"
Monitor[è¿›åº¦ç›‘æ§å™¨]
Callback[å›è°ƒå‡½æ•°]
end
subgraph "LangGraphåç«¯"
Graph[çŠ¶æ€å›¾]
Agent[å„ä¸ªAgent]
State[çŠ¶æ€ç®¡ç†]
end
UI --> WS
UI --> Poll
WS --> Monitor
Poll --> Monitor
Monitor --> Callback
Callback --> Graph
Graph --> Agent
Agent --> State
State --> Monitor
```

**å›¾è¡¨æ¥æº**
- [streaming.py](file://ai_correction/functions/langgraph/streaming.py#L40-L90)

### è¿›åº¦äº‹ä»¶ç±»å‹

ç³»ç»Ÿå®šä¹‰äº†å®Œæ•´çš„è¿›åº¦äº‹ä»¶ä½“ç³»ï¼Œç”¨äºç²¾ç¡®è·Ÿè¸ªæ‰¹æ”¹è¿‡ç¨‹çš„æ¯ä¸ªé˜¶æ®µï¼š

| äº‹ä»¶ç±»å‹ | æè¿° | è§¦å‘æ¡ä»¶ |
|---------|------|----------|
| `STARTED` | ä»»åŠ¡å¼€å§‹ | å·¥ä½œæµå¯åŠ¨æ—¶ |
| `STEP_STARTED` | æ­¥éª¤å¼€å§‹ | æ–°çš„Agentå¼€å§‹å¤„ç† |
| `STEP_COMPLETED` | æ­¥éª¤å®Œæˆ | Agentå¤„ç†å®Œæˆ |
| `PROGRESS_UPDATE` | è¿›åº¦æ›´æ–° | å®æ—¶è¿›åº¦å˜åŒ– |
| `ERROR` | é”™è¯¯å‘ç”Ÿ | å¤„ç†è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ |
| `COMPLETED` | ä»»åŠ¡å®Œæˆ | æ‰€æœ‰æ­¥éª¤æˆåŠŸå®Œæˆ |
| `FAILED` | ä»»åŠ¡å¤±è´¥ | å‡ºç°ä¸å¯æ¢å¤çš„é”™è¯¯ |

**ç« èŠ‚æ¥æº**
- [streaming.py](file://ai_correction/functions/langgraph/streaming.py#L20-L35)

## çŠ¶æ€ç®¡ç†ç³»ç»Ÿ

ç³»ç»Ÿä½¿ç”¨`st.session_state`ä½œä¸ºä¸»è¦çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ï¼Œç¡®ä¿ç”¨æˆ·åœ¨ä¸åŒé¡µé¢é—´åˆ‡æ¢æ—¶èƒ½å¤Ÿä¿æŒè¿ç»­çš„æ‰¹æ”¹ä½“éªŒã€‚

### çŠ¶æ€å­—æ®µè®¾è®¡

```mermaid
classDiagram
class SessionState {
+bool logged_in
+str username
+str page
+dict correction_result
+list uploaded_files_data
+int current_file_index
+dict correction_settings
+str current_task_id
+init_session()
+update_state()
+clear_state()
}
class FileData {
+str name
+str path
+str type
+datetime timestamp
}
class CorrectionSettings {
+str mode
+str strictness
+str language
+dict advanced_options
}
SessionState --> FileData : contains
SessionState --> CorrectionSettings : uses
```

**å›¾è¡¨æ¥æº**
- [main.py](file://ai_correction/main.py#L423-L428)

### çŠ¶æ€æŒä¹…åŒ–ç­–ç•¥

ç³»ç»Ÿé‡‡ç”¨å†…å­˜çŠ¶æ€ç®¡ç†ï¼Œç»“åˆæ–‡ä»¶ç³»ç»Ÿå­˜å‚¨å®ç°çŠ¶æ€çš„ä¸´æ—¶æŒä¹…åŒ–ï¼š

1. **ä¼šè¯çŠ¶æ€**ï¼šå­˜å‚¨åœ¨æµè§ˆå™¨å†…å­˜ä¸­ï¼Œé¡µé¢åˆ·æ–°æ—¶ä¸¢å¤±
2. **æ–‡ä»¶ä¸Šä¼ **ï¼šä¿å­˜åœ¨æœ¬åœ°`uploads`ç›®å½•ï¼ŒæŒ‰ç”¨æˆ·éš”ç¦»
3. **æ‰¹æ”¹ç»“æœ**ï¼šå­˜å‚¨åœ¨`st.session_state`ä¸­ï¼Œé¡µé¢åˆ‡æ¢æ—¶ä¿ç•™

**ç« èŠ‚æ¥æº**
- [main.py](file://ai_correction/main.py#L423-L428)

## å¼‚æ­¥ä»»åŠ¡å¤„ç†

ç³»ç»Ÿé‡‡ç”¨å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹å¤„ç†è€—æ—¶çš„æ‰¹æ”¹ä»»åŠ¡ï¼Œç¡®ä¿å‰ç«¯ç•Œé¢ä¸ä¼šå› ä¸ºé•¿æ—¶é—´çš„æ‰¹æ”¹æ“ä½œè€Œå†»ç»“ã€‚

### å¼‚æ­¥æ‰§è¡Œæµç¨‹

```mermaid
sequenceDiagram
participant UI as å‰ç«¯ç•Œé¢
participant Task as ä»»åŠ¡è°ƒåº¦å™¨
participant Monitor as è¿›åº¦ç›‘æ§
participant Worker as å·¥ä½œæµæ‰§è¡Œå™¨
participant Agent as å„ä¸ªAgent
UI->>Task : æäº¤æ‰¹æ”¹ä»»åŠ¡
Task->>Monitor : å¯åŠ¨è¿›åº¦ç›‘æ§
Task->>Worker : å¯åŠ¨å¼‚æ­¥æ‰§è¡Œ
Worker->>Agent : æ‰§è¡Œç¬¬ä¸€ä¸ªAgent
Agent-->>Worker : è¿”å›ä¸­é—´ç»“æœ
Worker->>Monitor : æ›´æ–°è¿›åº¦
Monitor-->>UI : æ¨é€è¿›åº¦æ›´æ–°
Worker->>Agent : æ‰§è¡Œä¸‹ä¸€ä¸ªAgent
Agent-->>Worker : è¿”å›ä¸­é—´ç»“æœ
Worker->>Monitor : æ›´æ–°è¿›åº¦
Monitor-->>UI : æ¨é€è¿›åº¦æ›´æ–°
Worker-->>Task : è¿”å›æœ€ç»ˆç»“æœ
Task-->>UI : æ˜¾ç¤ºæ‰¹æ”¹ç»“æœ
```

**å›¾è¡¨æ¥æº**
- [workflow_multimodal.py](file://ai_correction/functions/langgraph/workflow_multimodal.py#L150-L200)
- [streaming.py](file://ai_correction/functions/langgraph/streaming.py#L100-L150)

### ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†

ç³»ç»Ÿæä¾›å®Œæ•´çš„ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬ä»»åŠ¡åˆ›å»ºã€æ‰§è¡Œã€ç›‘æ§å’Œæ¸…ç†ï¼š

| ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ | æ“ä½œ | çŠ¶æ€å˜æ›´ |
|-------------|------|----------|
| åˆ›å»º | ç”Ÿæˆä»»åŠ¡IDï¼Œåˆå§‹åŒ–çŠ¶æ€ | pending â†’ running |
| æ‰§è¡Œ | å¯åŠ¨å·¥ä½œæµï¼Œå¼€å§‹å¤„ç† | running â†’ processing |
| ç›‘æ§ | å®æ—¶æ›´æ–°è¿›åº¦ï¼Œæ•è·é”™è¯¯ | processing â†’ completed/failed |
| æ¸…ç† | ç§»é™¤è¿‡æœŸä»»åŠ¡ï¼Œé‡Šæ”¾èµ„æº | completed/failed â†’ cleaned |

**ç« èŠ‚æ¥æº**
- [langgraph_integration.py](file://ai_correction/functions/langgraph_integration.py#L150-L200)

## ç»“æœå±•ç¤ºä¸äº¤äº’

ç³»ç»Ÿæä¾›äº†ä¸°å¯Œçš„ç»“æœå±•ç¤ºåŠŸèƒ½ï¼Œé‡‡ç”¨å¡ç‰‡å¼è®¾è®¡å’ŒæŠ˜å é¢æ¿ç»“æ„ï¼Œä½¿å¤æ‚çš„æ‰¹æ”¹ç»“æœæ˜“äºç†è§£å’Œå¯¼èˆªã€‚

### æ‰¹æ”¹ç»“æœç•Œé¢å¸ƒå±€

```mermaid
graph TB
subgraph "ç»“æœå±•ç¤ºåŒºåŸŸ"
Summary[æ€»ä½“æˆç»©å¡ç‰‡]
Detail[é€é¢˜è¯¦æƒ…é¢æ¿]
Feedback[è¯¦ç»†åé¦ˆåŒºåŸŸ]
Visual[å¯è§†åŒ–å›¾è¡¨]
end
subgraph "äº¤äº’æ§åˆ¶"
Download[ä¸‹è½½æŒ‰é’®]
History[å†å²è®°å½•]
Settings[è®¾ç½®è°ƒæ•´]
end
Summary --> Detail
Detail --> Feedback
Feedback --> Visual
Visual --> Download
Download --> History
History --> Settings
```

**å›¾è¡¨æ¥æº**
- [main.py](file://ai_correction/main.py#L650-L750)

### æˆç»©å¡ç‰‡è®¾è®¡

ç³»ç»Ÿé‡‡ç”¨å››ç»´æˆç»©å¡ç‰‡è®¾è®¡ï¼Œé€šè¿‡é¢œè‰²ç¼–ç å’Œå›¾æ ‡å¢å¼ºè§†è§‰æ•ˆæœï¼š

| æŒ‡æ ‡ç±»å‹ | é¢œè‰²ç¼–ç  | å›¾æ ‡ | è¯´æ˜ |
|---------|----------|------|------|
| æ€»åˆ† | è“è‰² | ğŸ“Š | å½“å‰å¾—åˆ†/æ»¡åˆ† |
| å¾—åˆ†ç‡ | ç»¿è‰² | ğŸ‰ | ç™¾åˆ†æ¯”æ˜¾ç¤º |
| ç­‰çº§ | æ©™è‰² | ğŸ† | å­—æ¯ç­‰çº§ |
| ç­”å¯¹é¢˜æ•° | çº¢è‰² | âœ… | æ­£ç¡®é¢˜ç›®æ•°é‡ |

### é€é¢˜è¯¦æƒ…å±•ç¤º

æ¯ä¸ªé¢˜ç›®éƒ½é‡‡ç”¨æŠ˜å é¢æ¿è®¾è®¡ï¼ŒåŒ…å«å®Œæ•´çš„è¯„åˆ†ä¿¡æ¯ï¼š

```mermaid
graph TD
Question[é¢˜ç›®æ ‡é¢˜] --> QuestionContent[é¢˜ç›®å†…å®¹]
Question --> AnswerContent[å­¦ç”Ÿç­”æ¡ˆ]
Question --> ScoringDetail[è¯„åˆ†è¯¦æƒ…]
Question --> OverallFeedback[æ€»ä½“è¯„ä»·]
Question --> Strengths[ä¼˜ç‚¹]
Question --> Weaknesses[ä¸è¶³]
Question --> Suggestions[æ”¹è¿›å»ºè®®]
```

**å›¾è¡¨æ¥æº**
- [UI_OPTIMIZATION_SUMMARY.md](file://ai_correction/docs/UI_OPTIMIZATION_SUMMARY.md#L120-L180)

**ç« èŠ‚æ¥æº**
- [main.py](file://ai_correction/main.py#L650-L750)

## é”™è¯¯å¤„ç†ä¸æ•…éšœæ’é™¤

ç³»ç»Ÿå®ç°äº†å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œèƒ½å¤Ÿä¼˜é›…åœ°å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µï¼Œå¹¶ä¸ºç”¨æˆ·æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®ã€‚

### å¸¸è§é”™è¯¯ç±»å‹

| é”™è¯¯ç±»åˆ« | é”™è¯¯ä»£ç  | æè¿° | è§£å†³æ–¹æ¡ˆ |
|---------|----------|------|----------|
| æ–‡ä»¶ä¸Šä¼ é”™è¯¯ | UPLOAD_FAILED | æ–‡ä»¶ä¸Šä¼ å¤±è´¥ | æ£€æŸ¥æ–‡ä»¶æ ¼å¼å’Œå¤§å°é™åˆ¶ |
| å‚æ•°éªŒè¯é”™è¯¯ | INVALID_PARAMS | å‚æ•°é…ç½®æ— æ•ˆ | é‡æ–°æ£€æŸ¥æ‰¹æ”¹å‚æ•°è®¾ç½® |
| ç½‘ç»œè¿æ¥é”™è¯¯ | NETWORK_ERROR | ä¸æœåŠ¡å™¨è¿æ¥å¤±è´¥ | æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€ |
| å¤„ç†è¶…æ—¶é”™è¯¯ | TIMEOUT_ERROR | æ‰¹æ”¹å¤„ç†è¶…æ—¶ | å‡å°‘æ–‡ä»¶å¤§å°æˆ–ç®€åŒ–æ‰¹æ”¹æ¨¡å¼ |
| ç³»ç»Ÿå†…éƒ¨é”™è¯¯ | INTERNAL_ERROR | å†…éƒ¨ç³»ç»Ÿé”™è¯¯ | è”ç³»æŠ€æœ¯æ”¯æŒ |

### é”™è¯¯æ¢å¤ç­–ç•¥

```mermaid
flowchart TD
Error[æ£€æµ‹åˆ°é”™è¯¯] --> Classify[é”™è¯¯åˆ†ç±»]
Classify --> Recoverable{å¯æ¢å¤?}
Recoverable --> |æ˜¯| Retry[é‡è¯•æœºåˆ¶]
Recoverable --> |å¦| Fallback[é™çº§å¤„ç†]
Retry --> Success{é‡è¯•æˆåŠŸ?}
Success --> |æ˜¯| Continue[ç»§ç»­å¤„ç†]
Success --> |å¦| Fallback
Fallback --> Notify[é€šçŸ¥ç”¨æˆ·]
Notify --> Log[è®°å½•é”™è¯¯æ—¥å¿—]
Log --> End[ç»“æŸå¤„ç†]
Continue --> End
```

**å›¾è¡¨æ¥æº**
- [langgraph_integration.py](file://ai_correction/functions/langgraph_integration.py#L80-L120)

### æ•…éšœæ’é™¤æŒ‡å—

å¯¹äºå¸¸è§çš„æ‰¹æ”¹é—®é¢˜ï¼Œç³»ç»Ÿæä¾›äº†è¯¦ç»†çš„æ•…éšœæ’é™¤æŒ‡å—ï¼š

1. **ä¸Šä¼ å¤±è´¥**
   - æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ”¯æŒ
   - ç¡®è®¤æ–‡ä»¶å¤§å°ä¸è¶…è¿‡é™åˆ¶
   - éªŒè¯ç½‘ç»œè¿æ¥ç¨³å®šæ€§

2. **æ‰¹æ”¹ç»“æœä¸ºç©º**
   - ç¡®è®¤æ‰€æœ‰å¿…éœ€æ–‡ä»¶éƒ½å·²ä¸Šä¼ 
   - æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦æ¸…æ™°å¯è¯»
   - å°è¯•ä½¿ç”¨ä¸åŒçš„æ‰¹æ”¹æ¨¡å¼

3. **é•¿æ—¶é—´æ— å“åº”**
   - æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½æƒ…å†µ
   - ç­‰å¾…æ›´é•¿æ—¶é—´ï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰
   - è”ç³»æŠ€æœ¯æ”¯æŒè·å–å¸®åŠ©

**ç« èŠ‚æ¥æº**
- [langgraph_integration.py](file://ai_correction/functions/langgraph_integration.py#L150-L200)

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

ç³»ç»Ÿé‡‡ç”¨äº†å¤šå±‚æ¬¡çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œç¡®ä¿åœ¨å¤„ç†å¤§é‡æ–‡ä»¶å’Œå¤æ‚æ‰¹æ”¹ä»»åŠ¡æ—¶ä»èƒ½ä¿æŒè‰¯å¥½çš„å“åº”æ€§èƒ½ã€‚

### å¤šæ¨¡æ€ä¼˜åŒ–

ç³»ç»Ÿé‡‡ç”¨æ·±åº¦åä½œçš„8-Agentæ¶æ„ï¼Œå®ç°äº†Tokenä½¿ç”¨çš„æè‡´ä¼˜åŒ–ï¼š

- **ä¸€æ¬¡ç†è§£ï¼Œå¤šæ¬¡ä½¿ç”¨**ï¼šè¯„åˆ†æ ‡å‡†è¢«ä¸€æ¬¡æ€§æ·±åº¦ç†è§£ï¼Œç”Ÿæˆå‹ç¼©åŒ…ä¼ é€’ç»™åç»­Agent
- **å¹¶è¡Œå¤„ç†**ï¼šå¤šä¸ªAgentåŒæ—¶å¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶ç†è§£ä»»åŠ¡
- **æ‰¹æ¬¡ç®¡ç†**ï¼šåŸºäºå­¦ç”Ÿä¿¡æ¯çš„æ™ºèƒ½æ‰¹æ¬¡åˆ’åˆ†ï¼Œæé«˜å¤„ç†æ•ˆç‡

### ç¼“å­˜ç­–ç•¥

| ç¼“å­˜å±‚çº§ | ç¼“å­˜å†…å®¹ | ç”Ÿå‘½å‘¨æœŸ | æ¸…ç†ç­–ç•¥ |
|---------|----------|----------|----------|
| å†…å­˜ç¼“å­˜ | ä¸´æ—¶å¤„ç†ç»“æœ | ä¼šè¯æœŸé—´ | ä¼šè¯ç»“æŸæ—¶æ¸…ç† |
| æ–‡ä»¶ç¼“å­˜ | å¤„ç†è¿‡çš„æ–‡ä»¶ | 24å°æ—¶ | è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ–‡ä»¶ |
| æ•°æ®åº“ç¼“å­˜ | æ‰¹æ”¹å†å²è®°å½• | æ°¸ä¹…å­˜å‚¨ | æ‰‹åŠ¨æ¸…ç† |

### å¹¶å‘å¤„ç†ä¼˜åŒ–

```mermaid
graph LR
subgraph "å¹¶å‘å¤„ç†æ¶æ„"
Queue[ä»»åŠ¡é˜Ÿåˆ—]
Scheduler[ä»»åŠ¡è°ƒåº¦å™¨]
Worker1[å·¥ä½œçº¿ç¨‹1]
Worker2[å·¥ä½œçº¿ç¨‹2]
Worker3[å·¥ä½œçº¿ç¨‹3]
Result[ç»“æœåˆå¹¶å™¨]
end
Queue --> Scheduler
Scheduler --> Worker1
Scheduler --> Worker2
Scheduler --> Worker3
Worker1 --> Result
Worker2 --> Result
Worker3 --> Result
Result --> Final[æœ€ç»ˆç»“æœ]
```

**å›¾è¡¨æ¥æº**
- [workflow_multimodal.py](file://ai_correction/functions/langgraph/workflow_multimodal.py#L50-L100)

### å‰ç«¯æ€§èƒ½ä¼˜åŒ–

å‰ç«¯ç•Œé¢é‡‡ç”¨æ‡’åŠ è½½å’Œè™šæ‹Ÿæ»šåŠ¨æŠ€æœ¯ï¼Œç¡®ä¿åœ¨å¤„ç†å¤§é‡æ‰¹æ”¹ç»“æœæ—¶ä»èƒ½ä¿æŒæµç•…çš„ç”¨æˆ·ä½“éªŒï¼š

- **å›¾ç‰‡é¢„è§ˆ**ï¼šé‡‡ç”¨Base64ç¼–ç ï¼Œå‡å°‘HTTPè¯·æ±‚
- **æ–‡ä»¶åˆ—è¡¨**ï¼šä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼Œåªæ¸²æŸ“å¯è§åŒºåŸŸ
- **è¿›åº¦æ›´æ–°**ï¼šé‡‡ç”¨WebSocketå®æ—¶æ¨é€ï¼Œé¿å…é¢‘ç¹è½®è¯¢

**ç« èŠ‚æ¥æº**
- [main.py](file://ai_correction/main.py#L200-L300)