# 学生助手与错题本深度集成

## 概述
将学生错题本与AI学生助手深度打通，实现多模态错题分析功能。

## 用户故事

### US-1: 错题深究跳转
**作为** 学生
**我想要** 在错题本点击"深究这道题"后自动跳转到学生助手
**以便于** AI能够分析我的错题并帮助我理解

**验收标准:**
- AC-1.1: 点击"深究这道题"按钮后，错题上下文存储到 localStorage
- AC-1.2: 跳转到 `/student/student_assistant?from=wrongbook`
- AC-1.3: 学生助手检测到参数后自动读取错题上下文
- AC-1.4: 清空历史对话，开启新的上下文

### US-2: 多模态错题分析
**作为** 学生
**我想要** AI能够看到我的错题图片（答题卡扫描件）
**以便于** AI能够更准确地分析我的错误

**验收标准:**
- AC-2.1: 错题上下文包含相关图片（base64 或 URL）
- AC-2.2: 后端 assistant API 支持接收图片参数
- AC-2.3: Gemini API 调用时传入图片进行多模态分析
- AC-2.4: AI 响应中包含对图片内容的分析

### US-3: 启发式教学
**作为** 学生
**我想要** AI 采用苏格拉底式提问引导我思考
**以便于** 我能真正理解错误原因而不是直接看答案

**验收标准:**
- AC-3.1: AI 首先分析错误类型（概念错误/计算错误/粗心等）
- AC-3.2: AI 通过提问引导学生发现问题
- AC-3.3: AI 提供类似练习题巩固知识点
- AC-3.4: AI 追踪学生对该知识点的掌握程度

## 技术要点

### 前端修改
1. `AIChat.tsx` - 处理 `from=wrongbook` 参数，自动发送带图片的消息
2. `api.ts` - `assistantApi.chat` 支持 `images` 参数

### 后端修改
1. `unified_api.py` - `/api/assistant/chat` 接口支持 `images` 字段
2. Gemini 调用逻辑 - 构建多模态 prompt

### 数据流
```
错题本 → localStorage → 学生助手前端 → 后端 API → Gemini (多模态) → 响应
```

## 当前状态
- [x] 错题本"深究这道题"按钮已实现跳转
- [x] localStorage 存储错题上下文
- [ ] AIChat.tsx 自动发送消息（需调试）
- [ ] 后端支持多模态图片
- [ ] Gemini 多模态调用
