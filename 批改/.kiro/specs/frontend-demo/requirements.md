# 需求文档

## 简介

本文档定义了 AI 批改系统前端演示应用的需求规范。该前端应用旨在提供一个直观的界面，用于实验和展示 AI 批改系统的核心功能，包括试卷上传、评分细则配置、批改进度监控、结果查看和人工审核。前端采用现代化的 Web 技术栈，支持实时状态更新和响应式设计。

## 术语表

- **提交（Submission）**: 学生上传的试卷文件及其批改状态
- **评分细则（Rubric）**: 教师配置的评分标准和评分点
- **批改结果（Grading Result）**: AI 对单个题目的评分、反馈和证据链
- **置信度（Confidence）**: AI 对评分结果的确信程度，0-1 之间
- **人工审核（Review）**: 教师对低置信度结果的人工复核
- **WebSocket**: 用于实时推送状态变更的双向通信协议
- **视觉标注（Visual Annotation）**: 在试卷图像上标记的评分依据区域

## 需求列表

### 需求 1：试卷上传与提交

**用户故事：** 作为教师，我希望能够上传学生试卷并提交批改，以便快速获得 AI 评分结果。

#### 验收标准

1. WHEN 用户访问上传页面时，系统应当显示文件上传区域，支持拖拽和点击选择文件
2. WHEN 用户选择文件时，系统应当验证文件格式为 PDF、JPEG、PNG 或 WEBP
3. WHEN 用户选择文件时，系统应当验证文件大小不超过 10MB
4. WHEN 用户填写考试 ID 和学生 ID 并点击提交时，系统应当调用 API 创建提交
5. WHEN 提交成功时，系统应当显示提交 ID 并自动跳转到进度监控页面
6. WHEN 提交失败时，系统应当显示明确的错误信息

### 需求 2：评分细则管理

**用户故事：** 作为教师，我希望能够配置评分细则，以便 AI 按照我的标准进行评分。

#### 验收标准

1. WHEN 用户访问评分细则页面时，系统应当显示已有评分细则列表
2. WHEN 用户点击创建按钮时，系统应当显示评分细则创建表单
3. WHEN 用户填写评分细则时，系统应当支持添加多个评分点，每个评分点包含描述和分值
4. WHEN 用户提交评分细则时，系统应当验证总分等于各评分点分值之和
5. WHEN 用户点击编辑按钮时，系统应当加载现有评分细则并允许修改
6. WHEN 评分细则保存成功时，系统应当显示成功提示并刷新列表

### 需求 3：批改进度监控

**用户故事：** 作为教师，我希望能够实时查看批改进度，以便了解批改任务的执行状态。

#### 验收标准

1. WHEN 用户访问进度监控页面时，系统应当建立 WebSocket 连接订阅状态更新
2. WHEN 批改状态变更时，系统应当实时更新进度条和状态文本
3. WHEN 批改进行中时，系统应当显示当前处理的题目编号和预计剩余时间
4. WHEN 批改完成时，系统应当显示完成提示并提供查看结果的链接
5. WHEN WebSocket 连接断开时，系统应当自动重连并恢复状态订阅
6. WHEN 用户离开页面时，系统应当正确关闭 WebSocket 连接

### 需求 4：批改结果展示

**用户故事：** 作为教师，我希望能够查看详细的批改结果，以便了解 AI 的评分依据。

#### 验收标准

1. WHEN 用户访问结果页面时，系统应当显示试卷总分和各题目得分
2. WHEN 用户点击某题目时，系统应当展开显示该题目的详细评分信息
3. WHEN 显示题目详情时，系统应当展示 AI 反馈、置信度和证据链
4. WHEN 显示证据链时，系统应当在试卷图像上高亮标注相关区域
5. WHEN 题目置信度低于 0.75 时，系统应当用醒目颜色标记该题目
6. WHEN 用户点击导出按钮时，系统应当生成包含评分详情的 PDF 报告

### 需求 5：人工审核界面

**用户故事：** 作为教师，我希望能够审核低置信度的评分结果，以便确保评分准确性。

#### 验收标准

1. WHEN 用户访问审核页面时，系统应当显示所有待审核的题目列表
2. WHEN 用户选择某待审核题目时，系统应当并排显示试卷图像和 AI 评分详情
3. WHEN 用户点击批准按钮时，系统应当发送 APPROVE 信号确认 AI 评分
4. WHEN 用户输入新分数并点击覆盖按钮时，系统应当发送 OVERRIDE 信号覆盖评分
5. WHEN 用户点击拒绝按钮时，系统应当发送 REJECT 信号并要求输入拒绝原因
6. WHEN 审核操作完成时，系统应当更新待审核列表并显示操作结果

### 需求 6：提交历史查询

**用户故事：** 作为教师，我希望能够查询历史提交记录，以便追踪学生的批改历史。

#### 验收标准

1. WHEN 用户访问历史页面时，系统应当显示分页的提交列表
2. WHEN 用户设置筛选条件时，系统应当支持按考试 ID、学生 ID 和状态筛选
3. WHEN 用户点击排序按钮时，系统应当支持按提交时间、总分排序
4. WHEN 用户调整每页数量时，系统应当重新加载对应数量的记录
5. WHEN 用户点击某条记录时，系统应当跳转到该提交的结果详情页
6. WHEN 数据加载中时，系统应当显示加载指示器

### 需求 7：仪表盘概览

**用户故事：** 作为教师，我希望能够在仪表盘查看批改系统的整体状态，以便快速了解工作进展。

#### 验收标准

1. WHEN 用户访问仪表盘时，系统应当显示今日提交数、完成数和待审核数
2. WHEN 用户访问仪表盘时，系统应当显示最近 7 天的批改趋势图表
3. WHEN 用户访问仪表盘时，系统应当显示平均置信度和平均批改时间
4. WHEN 有待审核任务时，系统应当在仪表盘显示醒目的待审核提醒
5. WHEN 用户点击统计卡片时，系统应当跳转到对应的详情页面
6. WHEN 数据更新时，系统应当自动刷新仪表盘数据

### 需求 8：响应式设计与用户体验

**用户故事：** 作为用户，我希望系统在不同设备上都能良好显示，以便在各种场景下使用。

#### 验收标准

1. WHEN 用户在桌面浏览器访问时，系统应当显示完整的侧边栏导航
2. WHEN 用户在平板设备访问时，系统应当自动折叠侧边栏为图标模式
3. WHEN 用户在手机设备访问时，系统应当显示底部导航栏替代侧边栏
4. WHEN 页面加载时，系统应当显示骨架屏占位符
5. WHEN 操作执行中时，系统应当显示加载状态并禁用重复提交
6. WHEN 操作成功或失败时，系统应当显示 Toast 通知

### 需求 9：图像查看与标注

**用户故事：** 作为教师，我希望能够清晰查看试卷图像并理解 AI 的标注，以便准确审核评分。

#### 验收标准

1. WHEN 用户查看试卷图像时，系统应当支持缩放和平移操作
2. WHEN 用户双击图像时，系统应当放大到 100% 显示
3. WHEN 显示 AI 标注时，系统应当用不同颜色区分正确和错误区域
4. WHEN 用户悬停在标注区域时，系统应当显示该区域对应的评分点信息
5. WHEN 用户点击标注区域时，系统应当滚动到对应的评分详情
6. WHEN 图像加载失败时，系统应当显示占位图和重试按钮

### 需求 10：错误处理与离线支持

**用户故事：** 作为用户，我希望系统能够优雅处理错误并在网络不稳定时保持可用，以便获得流畅的使用体验。

#### 验收标准

1. WHEN API 请求失败时，系统应当显示友好的错误信息和重试按钮
2. WHEN 网络断开时，系统应当显示离线提示并缓存已加载的数据
3. WHEN 网络恢复时，系统应当自动重新连接并同步数据
4. WHEN 发生 429 限流错误时，系统应当显示等待时间并自动重试
5. WHEN 发生 500 服务器错误时，系统应当提供联系支持的选项
6. WHEN 表单提交失败时，系统应当保留用户输入的数据

