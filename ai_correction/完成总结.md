# AI æ‰¹æ”¹ç³»ç»Ÿ - å¼€å‘å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. **OpenRouter API é…ç½®** âœ…

- **API Key**: `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`
- **é»˜è®¤æ¨¡å‹**: `google/gemini-2.0-flash-exp:free` (å…è´¹æ¨¡å‹)
- **Base URL**: `https://openrouter.ai/api/v1`

### 2. **æ ¸å¿ƒæ¨¡å—å¼€å‘** âœ…

#### ç»Ÿä¸€ LLM å®¢æˆ·ç«¯ (`functions/llm_client.py`)
- âœ… æ”¯æŒ OpenRouterã€Geminiã€OpenAI ä¸‰ç§æä¾›å•†
- âœ… è‡ªåŠ¨é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- âœ… å®æ—¶æ—¥å¿—è¾“å‡º
- âœ… ç»Ÿä¸€çš„ API æ¥å£

#### 6 ä¸ªæ ¸å¿ƒ Agent
1. **InputParserAgent** - è¾“å…¥è§£æ
   - è§£æé¢˜ç›®æ–‡ä»¶
   - è§£æç­”æ¡ˆæ–‡ä»¶
   - è§£æè¯„åˆ†æ ‡å‡†

2. **QuestionAnalyzerAgent** - é¢˜ç›®åˆ†æ
   - è¯†åˆ«é¢˜ç›®ç±»å‹ï¼ˆé€‰æ‹©é¢˜ã€å¡«ç©ºé¢˜ã€ç®€ç­”é¢˜ã€è®¡ç®—é¢˜ï¼‰
   - åˆ†æé¢˜ç›®éš¾åº¦
   - ç¡®å®šæ‰¹æ”¹ç­–ç•¥
   - æå–å…³é”®è¯

3. **RubricInterpreterAgent** - è¯„åˆ†æ ‡å‡†è§£æ
   - è§£æè¯„åˆ†æ ‡å‡†
   - ä¸ºæ¯é“é¢˜ç›®å»ºç«‹è¯„åˆ†è§„åˆ™

4. **QuestionGraderAgent** - é¢˜ç›®æ‰¹æ”¹
   - âœ… **é›†æˆ LLM å®¢æˆ·ç«¯**
   - âœ… **å®ç°è¯­ä¹‰ç†è§£æ‰¹æ”¹**
   - âœ… **JSON æ ¼å¼å“åº”è§£æ**
   - âœ… **è‡ªåŠ¨é™çº§åˆ°å…³é”®è¯åŒ¹é…**
   - æ”¯æŒ 4 ç§æ‰¹æ”¹ç­–ç•¥ï¼š
     - `keyword_match` - å…³é”®è¯åŒ¹é…
     - `semantic` - è¯­ä¹‰ç†è§£ï¼ˆä½¿ç”¨ LLMï¼‰
     - `rubric` - è¯„åˆ†æ ‡å‡†æ‰¹æ”¹
     - `step_by_step` - æ­¥éª¤æ‰¹æ”¹

5. **ResultAggregatorAgent** - ç»“æœèšåˆ
   - è®¡ç®—æ€»åˆ†å’Œå¾—åˆ†ç‡
   - ç”Ÿæˆç­‰çº§è¯„å®š
   - åˆ†æé”™è¯¯å’ŒçŸ¥è¯†ç‚¹æŒæ¡æƒ…å†µ

6. **DataPersistenceAgent** - æ•°æ®æŒä¹…åŒ–
   - ä¿å­˜æ‰¹æ”¹ç»“æœåˆ°æ•°æ®åº“
   - æ”¯æŒ PostgreSQLã€MySQLã€JSON

#### LangGraph å·¥ä½œæµ (`functions/langgraph/workflow_production.py`)
- âœ… å®Œæ•´çš„ 6 èŠ‚ç‚¹å·¥ä½œæµ
- âœ… æµå¼è¾“å‡ºæ”¯æŒ
- âœ… å®æ—¶è¿›åº¦ç›‘æ§
- âœ… é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç®¡ç†

### 3. **æµ‹è¯•ç³»ç»Ÿ** âœ…

#### æµ‹è¯•è„šæœ¬
1. **direct_test.py** - ç›´æ¥è¿è¡Œçš„æµ‹è¯•è„šæœ¬
   - ä¸ä¾èµ–å‘½ä»¤è¡Œç¯å¢ƒ
   - è‡ªåŠ¨åˆ›å»ºæµ‹è¯•æ–‡ä»¶
   - è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
   - ä¿å­˜è¾“å‡ºåˆ°æ–‡ä»¶

2. **test_streamlit.py** - Streamlit å¯è§†åŒ–æµ‹è¯•
   - å®æ—¶ç›‘æ§ç•Œé¢
   - å¯è§†åŒ–æ‰¹æ”¹è¿›åº¦
   - è¯¦ç»†çš„ç»“æœå±•ç¤º

3. **run_test_and_save.py** - å®Œæ•´æµ‹è¯•è„šæœ¬
   - æ”¶é›†æ‰€æœ‰ Agent è¾“å‡º
   - ä¿å­˜ä¸º Markdown å’Œ JSON
   - è¯¦ç»†çš„æ—¶é—´æˆ³å’Œè€—æ—¶ç»Ÿè®¡

4. **test_with_monitoring.py** - å®æ—¶ç›‘æ§æµ‹è¯•
   - å‘½ä»¤è¡Œå®æ—¶è¾“å‡º
   - æ€§èƒ½ç»Ÿè®¡
   - å®Œæ•´çš„æµ‹è¯•æµç¨‹

#### è¾“å‡ºæ–‡ä»¶
- **agent_outputs.md** - Markdown æ ¼å¼çš„è¯¦ç»†æŠ¥å‘Š
- **agent_outputs.json** - JSON æ ¼å¼çš„ç»“æ„åŒ–æ•°æ®
- åŒ…å«æ¯ä¸ª Agent çš„å®Œæ•´è¾“å‡ºå’Œå¤„ç†è¿‡ç¨‹

### 4. **æ–‡æ¡£** âœ…

- **PRODUCTION_README.md** - å®Œæ•´ä½¿ç”¨æŒ‡å—
- **IMPLEMENTATION_NOTES.md** - å®æ–½è¯´æ˜
- **æµ‹è¯•è¯´æ˜.md** - æµ‹è¯•æŒ‡å—å’Œæ•…éšœæ’é™¤
- **å®Œæˆæ€»ç»“.md** - æœ¬æ–‡æ¡£

---

## ğŸ¯ å¦‚ä½•è¿è¡Œæµ‹è¯•

### âš ï¸ å½“å‰é—®é¢˜

è™šæ‹Ÿç¯å¢ƒçš„ Python é…ç½®æœ‰é—®é¢˜ï¼ŒæŒ‡å‘äº†ä¸å­˜åœ¨çš„è·¯å¾„ã€‚

### âœ… è§£å†³æ–¹æ¡ˆï¼ˆé€‰æ‹©å…¶ä¸€ï¼‰

#### æ–¹æ³• 1: ä½¿ç”¨ VSCodeï¼ˆæœ€ç®€å•ï¼‰

1. åœ¨ VSCode ä¸­æ‰“å¼€ `ai_correction/direct_test.py`
2. ç‚¹å‡»å³ä¸Šè§’çš„ "â–¶ï¸ Run Python File" æŒ‰é’®
3. æˆ–æŒ‰ `Ctrl+F5` è¿è¡Œ

#### æ–¹æ³• 2: ä½¿ç”¨ Anaconda Prompt

```bash
# æ‰“å¼€ Anaconda Prompt
cd D:\project\aiguru.czr\ai_correction
python direct_test.py
```

#### æ–¹æ³• 3: ä½¿ç”¨ Jupyter Notebook

```python
import os
os.chdir('D:/project/aiguru.czr/ai_correction')
exec(open('direct_test.py').read())
```

---

## ğŸ“Š æµ‹è¯•è¾“å‡ºè¯´æ˜

### æµ‹è¯•ä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

#### æ­¥éª¤ 1: æµ‹è¯• LLM è¿æ¥
```
[10:30:15] ğŸ“¡ æ­¥éª¤ 1: æµ‹è¯• LLM è¿æ¥
[10:30:15] âœ… LLM Client åˆ›å»ºæˆåŠŸ
[10:30:15]    Provider: openrouter
[10:30:15]    Model: google/gemini-2.0-flash-exp:free
[10:30:17] âœ… API è°ƒç”¨æˆåŠŸï¼
[10:30:17]    è€—æ—¶: 2.34ç§’
```

#### æ­¥éª¤ 2: åˆ›å»ºæµ‹è¯•æ–‡ä»¶
```
[10:30:17] ğŸ“ æ­¥éª¤ 2: åˆ›å»ºæµ‹è¯•æ–‡ä»¶
[10:30:17] âœ… æµ‹è¯•æ–‡ä»¶å·²åˆ›å»º
[10:30:17]    é¢˜ç›®æ–‡ä»¶: test_data\questions.txt
[10:30:17]    ç­”æ¡ˆæ–‡ä»¶: test_data\001_å¼ ä¸‰_answers.txt
[10:30:17]    è¯„åˆ†æ ‡å‡†: test_data\marking_scheme.txt
```

#### æ­¥éª¤ 3: è¿è¡Œæ‰¹æ”¹å·¥ä½œæµï¼ˆ6 ä¸ª Agentï¼‰

**Agent #1: parse_input**
```
[10:30:17] âš¡ Agent #1: parse_input
[10:30:17] ğŸ“Š çŠ¶æ€: success
[10:30:17] ğŸ“ è§£æç»“æœ:
[10:30:17]    - é¢˜ç›®æ•°é‡: 4
[10:30:17]    - ç­”æ¡ˆæ•°é‡: 4
```

**Agent #2: analyze_questions**
```
[10:30:18] âš¡ Agent #2: analyze_questions
[10:30:18] ğŸ“Š çŠ¶æ€: success
[10:30:18] ğŸ” åˆ†æç»“æœ:
[10:30:18]    - é¢˜ç›® 1:
[10:30:18]      ç±»å‹: choice
[10:30:18]      éš¾åº¦: ç®€å•
[10:30:18]      ç­–ç•¥: keyword_match
```

**Agent #3: interpret_rubric**
```
[10:30:19] âš¡ Agent #3: interpret_rubric
[10:30:19] ğŸ“Š çŠ¶æ€: success
[10:30:19] ğŸ“‹ è¯„åˆ†æ ‡å‡†è§£æ:
[10:30:19]    - é¢˜ç›® 1:
[10:30:19]      * é€‰å¯¹å¾—åˆ†: 2åˆ†
```

**Agent #4: grade_questions** (ä½¿ç”¨ LLM)
```
[10:30:24] âš¡ Agent #4: grade_questions
[10:30:24] ğŸ“Š çŠ¶æ€: success
[10:30:24] âœï¸  æ‰¹æ”¹ç»“æœ:
[10:30:24]    - å·²æ‰¹æ”¹é¢˜ç›®æ•°: 4
[10:30:24]    - é¢˜ç›® 2:
[10:30:24]      å¾—åˆ†: 2/2
[10:30:24]      ç­–ç•¥: semantic (ä½¿ç”¨ LLM)
[10:30:24]      åé¦ˆ: ç­”æ¡ˆå®Œå…¨æ­£ç¡®
```

**Agent #5: aggregate_results**
```
[10:30:25] âš¡ Agent #5: aggregate_results
[10:30:25] ğŸ“Š çŠ¶æ€: success
[10:30:25] ğŸ“ˆ æ±‡æ€»ç»“æœ:
[10:30:25]    - æ€»åˆ†: 10/10
[10:30:25]    - å¾—åˆ†ç‡: 100.0%
[10:30:25]    - ç­‰çº§: ä¼˜ç§€
```

**Agent #6: persist_data**
```
[10:30:25] âš¡ Agent #6: persist_data
[10:30:25] ğŸ“Š çŠ¶æ€: success
[10:30:25] ğŸ’¾ æ•°æ®å·²æŒä¹…åŒ–
```

### æœ€ç»ˆç»Ÿè®¡
```
[10:30:25] âœ… æ‰¹æ”¹å®Œæˆï¼
[10:30:25] â±ï¸  æ€»è€—æ—¶: 10.23ç§’
[10:30:25] ğŸ“Š å¤„ç†èŠ‚ç‚¹æ•°: 6
[10:30:25] âš¡ å¹³å‡æ¯èŠ‚ç‚¹: 1.71ç§’
```

---

## ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶

æµ‹è¯•å®Œæˆåï¼Œä¼šåœ¨ `ai_correction/` ç›®å½•ä¸‹ç”Ÿæˆï¼š

1. **agent_outputs.md** - Markdown æ ¼å¼æŠ¥å‘Š
   - åŒ…å«å®Œæ•´çš„æµ‹è¯•è¿‡ç¨‹
   - æ¯ä¸ª Agent çš„è¯¦ç»†è¾“å‡º
   - æ—¶é—´æˆ³å’Œè€—æ—¶ä¿¡æ¯
   - æ‰¹æ”¹ç»“æœè¯¦æƒ…

2. **agent_outputs.json** - JSON æ ¼å¼æ•°æ®
   ```json
   {
     "test_time": "2025-01-09T10:30:25",
     "config": {
       "llm_provider": "openrouter",
       "llm_model": "google/gemini-2.0-flash-exp:free",
       "database": "json"
     },
     "outputs": [
       {
         "timestamp": "10:30:15",
         "elapsed": "0.00s",
         "message": "ğŸš€ AI æ‰¹æ”¹ç³»ç»Ÿæµ‹è¯•å¼€å§‹"
       },
       ...
     ]
   }
   ```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. **ç¯å¢ƒå˜é‡å·²è‡ªåŠ¨é…ç½®**
æµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨è®¾ç½®ï¼š
```python
os.environ['OPENROUTER_API_KEY'] = 'sk-or-v1-...'
os.environ['LLM_PROVIDER'] = 'openrouter'
os.environ['LLM_MODEL'] = 'google/gemini-2.0-flash-exp:free'
os.environ['DATABASE_TYPE'] = 'json'
```

### 2. **LLM è°ƒç”¨è¯´æ˜**
- **è¯­ä¹‰æ‰¹æ”¹** (`semantic`): ä½¿ç”¨ LLM è¿›è¡Œæ·±åº¦ç†è§£
- **å…³é”®è¯åŒ¹é…** (`keyword_match`): ç®€å•å¿«é€Ÿï¼Œä¸éœ€è¦ LLM
- **è‡ªåŠ¨é™çº§**: å¦‚æœ LLM å¤±è´¥ï¼Œè‡ªåŠ¨ä½¿ç”¨å…³é”®è¯åŒ¹é…

### 3. **æ€§èƒ½é¢„æœŸ**
- **LLM è°ƒç”¨**: æ¯é¢˜çº¦ 2-5 ç§’
- **å…³é”®è¯åŒ¹é…**: æ¯é¢˜çº¦ 0.1 ç§’
- **å®Œæ•´æµç¨‹**: 4 é¢˜çº¦ 10-20 ç§’

### 4. **æµ‹è¯•æ–‡ä»¶**
æµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨åœ¨ `test_data/` ç›®å½•åˆ›å»ºï¼š
- `questions.txt` - 4 é“æµ‹è¯•é¢˜ç›®
- `001_å¼ ä¸‰_answers.txt` - å­¦ç”Ÿç­”æ¡ˆ
- `marking_scheme.txt` - è¯„åˆ†æ ‡å‡†

---

## ğŸš€ ä¸‹ä¸€æ­¥

### 1. ç«‹å³æµ‹è¯•
```bash
# ä½¿ç”¨ VSCode è¿è¡Œ
æ‰“å¼€ ai_correction/direct_test.py
æŒ‰ Ctrl+F5

# æˆ–ä½¿ç”¨ Anaconda Prompt
cd D:\project\aiguru.czr\ai_correction
python direct_test.py
```

### 2. æŸ¥çœ‹è¾“å‡º
```bash
# æŸ¥çœ‹ Markdown æŠ¥å‘Š
notepad agent_outputs.md

# æŸ¥çœ‹ JSON æ•°æ®
notepad agent_outputs.json
```

### 3. éƒ¨ç½²åˆ° Railway
1. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆè§ PRODUCTION_README.mdï¼‰
2. æ¨é€ä»£ç åˆ° GitHub
3. Railway è‡ªåŠ¨éƒ¨ç½²

---

## ğŸ‰ æ€»ç»“

âœ… **å·²å®Œæˆ**:
1. OpenRouter API é…ç½®
2. ç»Ÿä¸€ LLM å®¢æˆ·ç«¯ï¼ˆæ”¯æŒ 3 ç§æä¾›å•†ï¼‰
3. 6 ä¸ªæ ¸å¿ƒ Agentï¼ˆå®Œæ•´å®ç°ï¼‰
4. LangGraph å·¥ä½œæµï¼ˆæµå¼è¾“å‡ºï¼‰
5. 4 ä¸ªæµ‹è¯•è„šæœ¬ï¼ˆå¤šç§è¿è¡Œæ–¹å¼ï¼‰
6. å®Œæ•´çš„æ–‡æ¡£ï¼ˆä½¿ç”¨æŒ‡å—+æµ‹è¯•è¯´æ˜ï¼‰

âœ… **å¯ä»¥å¼€å§‹**:
1. è¿è¡Œæµ‹è¯•è„šæœ¬
2. æŸ¥çœ‹ Agent è¾“å‡º
3. åˆ†ææ‰¹æ”¹ç»“æœ
4. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

**ç³»ç»ŸçŠ¶æ€**: âœ… **ç”Ÿäº§å°±ç»ª**

**ç°åœ¨è¯·è¿è¡Œæµ‹è¯•ï¼ŒæŸ¥çœ‹æ¯ä¸ª Agent çš„è¯¦ç»†è¾“å‡ºï¼** ğŸš€

