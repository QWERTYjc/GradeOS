# AI 批改系统 - 测试说明

## ⚠️ 当前问题

虚拟环境的 Python 配置有问题，指向了不存在的路径：
```
C:\Users\Administrator\AppData\Local\Programs\Python\Python313\python.exe
```

## 🔧 解决方案

### 方法 1: 使用 VSCode 运行（推荐）

1. 在 VSCode 中打开文件：`ai_correction/direct_test.py`
2. 点击右上角的 "▶️ Run Python File" 按钮
3. 或者按 `Ctrl+F5` 运行

### 方法 2: 使用 Anaconda Prompt

1. 打开 "Anaconda Prompt"
2. 执行以下命令：
```bash
cd D:\project\aiguru.czr\ai_correction
python direct_test.py
```

### 方法 3: 使用 Jupyter Notebook

1. 打开 Jupyter Notebook
2. 创建新的 Notebook
3. 复制以下代码并运行：

```python
import os
os.chdir('D:/project/aiguru.czr/ai_correction')
exec(open('direct_test.py').read())
```

### 方法 4: 修复虚拟环境

1. 删除当前虚拟环境：
```bash
cd D:\project\aiguru.czr
rmdir /s .venv
```

2. 重新创建虚拟环境（使用正确的 Python）：
```bash
# 找到正确的 Python 路径
where python

# 使用正确的 Python 创建虚拟环境
python -m venv .venv

# 激活虚拟环境
.venv\Scripts\activate

# 安装依赖
pip install -r ai_correction/requirements.txt

# 运行测试
cd ai_correction
python direct_test.py
```

## 📊 测试输出

测试完成后，会生成以下文件：

1. **agent_outputs.md** - Markdown 格式的详细输出
   - 包含每个 Agent 的处理过程
   - 包含时间戳和耗时信息
   - 包含详细的批改结果

2. **agent_outputs.json** - JSON 格式的结构化数据
   - 可用于程序化分析
   - 包含完整的配置和输出信息

3. **test_console_output.txt** - 控制台输出（如果使用 Tee-Object）

## 🎯 测试内容

测试脚本会执行以下步骤：

### 步骤 1: 测试 LLM 连接
- 创建 LLM 客户端
- 测试 API 调用
- 记录响应时间和内容

### 步骤 2: 创建测试文件
- 创建 4 道测试题目
- 创建学生答案
- 创建评分标准

### 步骤 3: 运行批改工作流
包含 6 个 Agent：

1. **parse_input** - 输入解析 Agent
   - 解析题目文件
   - 解析答案文件
   - 解析评分标准

2. **analyze_questions** - 题目分析 Agent
   - 识别题目类型（选择题、填空题、简答题、计算题）
   - 分析题目难度
   - 确定批改策略
   - 提取关键词

3. **interpret_rubric** - 评分标准解析 Agent
   - 解析评分标准
   - 为每道题目建立评分规则

4. **grade_questions** - 题目批改 Agent
   - 使用 LLM 进行语义理解批改
   - 使用关键词匹配批改
   - 生成详细反馈

5. **aggregate_results** - 结果聚合 Agent
   - 计算总分和得分率
   - 生成等级评定
   - 分析错误和知识点掌握情况

6. **persist_data** - 数据持久化 Agent
   - 保存批改结果到数据库

## 📋 预期输出示例

```
[10:30:15] ================================================================================
[10:30:15] 🚀 AI 批改系统测试开始
[10:30:15] ================================================================================

[10:30:15] 📡 步骤 1: 测试 LLM 连接
[10:30:15] --------------------------------------------------------------------------------
[10:30:15] ✅ LLM Client 创建成功
[10:30:15]    Provider: openrouter
[10:30:15]    Model: google/gemini-2.0-flash-exp:free
[10:30:15]    Base URL: https://openrouter.ai/api/v1

[10:30:15] 📡 测试 API 调用...
[10:30:17] ✅ API 调用成功！
[10:30:17]    耗时: 2.34秒
[10:30:17]    响应长度: 156 字符
[10:30:17]    响应内容: Python是一种高级、解释型、面向对象的编程语言，以其简洁易读的语法和强大的功能而闻名。...

[10:30:17] 📁 步骤 2: 创建测试文件
[10:30:17] --------------------------------------------------------------------------------
[10:30:17] ✅ 测试文件已创建
[10:30:17]    题目文件: test_data\questions.txt
[10:30:17]    答案文件: test_data\001_张三_answers.txt
[10:30:17]    评分标准: test_data\marking_scheme.txt

[10:30:17] 🚀 步骤 3: 运行批改工作流
[10:30:17] ================================================================================

[10:30:17] ⚡ Agent #1: parse_input
[10:30:17] --------------------------------------------------------------------------------
[10:30:17] 📊 状态: success
[10:30:17] 📝 解析结果:
[10:30:17]    - 题目数量: 4
[10:30:17]    - 答案数量: 4
[10:30:17]    - 题目 1: 计算 2 + 3 = ?...
[10:30:17]    - 题目 2: 填空：中国的首都是_____。...
[10:30:17]    - 题目 3: 简答题：请简述Python的主要特点。（至少3点）...
[10:30:17]    - 题目 4: 计算题：求解方程 x + 5 = 10，并写出解题步骤。...

[10:30:18] ⚡ Agent #2: analyze_questions
[10:30:18] --------------------------------------------------------------------------------
[10:30:18] 📊 状态: success
[10:30:18] 🔍 分析结果:
[10:30:18]    - 题目 1:
[10:30:18]      类型: choice
[10:30:18]      难度: 简单
[10:30:18]      策略: keyword_match
[10:30:18]      关键词: ['计算', '2', '3', '5']
[10:30:18]    - 题目 2:
[10:30:18]      类型: fill
[10:30:18]      难度: 简单
[10:30:18]      策略: semantic
[10:30:18]      关键词: ['中国', '首都', '北京']
[10:30:18]    - 题目 3:
[10:30:18]      类型: essay
[10:30:18]      难度: 中等
[10:30:18]      策略: rubric
[10:30:18]      关键词: ['Python', '特点', '编程语言']
[10:30:18]    - 题目 4:
[10:30:18]      类型: calculation
[10:30:18]      难度: 中等
[10:30:18]      策略: step_by_step
[10:30:18]      关键词: ['方程', 'x', '5', '10']

[10:30:19] ⚡ Agent #3: interpret_rubric
[10:30:19] --------------------------------------------------------------------------------
[10:30:19] 📊 状态: success
[10:30:19] 📋 评分标准解析:
[10:30:19]    - 题目 1:
[10:30:19]      * 选对得分: 2分
[10:30:19]    - 题目 2:
[10:30:19]      * 答案正确: 2分
[10:30:19]    - 题目 3:
[10:30:19]      * 提到"高级语言": 1分
[10:30:19]      * 提到"语法简洁": 1分
[10:30:19]      * 提到"丰富的库": 1分
[10:30:19]    - 题目 4:
[10:30:19]      * 列出方程: 1分
[10:30:19]      * 计算过程正确: 1分
[10:30:19]      * 答案正确: 1分

[10:30:24] ⚡ Agent #4: grade_questions
[10:30:24] --------------------------------------------------------------------------------
[10:30:24] 📊 状态: success
[10:30:24] ✍️  批改结果:
[10:30:24]    - 已批改题目数: 4
[10:30:24]    - 题目 1:
[10:30:24]      得分: 2/2
[10:30:24]      策略: keyword_match
[10:30:24]      反馈: 答案正确
[10:30:24]    - 题目 2:
[10:30:24]      得分: 2/2
[10:30:24]      策略: semantic
[10:30:24]      反馈: 答案完全正确
[10:30:24]    - 题目 3:
[10:30:24]      得分: 3/3
[10:30:24]      策略: rubric
[10:30:24]      反馈: 答案涵盖了所有要点，表述清晰
[10:30:24]    - 题目 4:
[10:30:24]      得分: 3/3
[10:30:24]      策略: step_by_step
[10:30:24]      反馈: 解题步骤完整，答案正确

[10:30:25] ⚡ Agent #5: aggregate_results
[10:30:25] --------------------------------------------------------------------------------
[10:30:25] 📊 状态: success
[10:30:25] 📈 汇总结果:
[10:30:25]    - 总分: 10/10
[10:30:25]    - 得分率: 100.0%
[10:30:25]    - 等级: 优秀
[10:30:25]    - 知识点掌握:
[10:30:25]      * 基础计算: 100.0%
[10:30:25]      * 语言表达: 100.0%
[10:30:25]      * 逻辑推理: 100.0%

[10:30:25] ⚡ Agent #6: persist_data
[10:30:25] --------------------------------------------------------------------------------
[10:30:25] 📊 状态: success
[10:30:25] 💾 数据已持久化

[10:30:25] ================================================================================
[10:30:25] ✅ 批改完成！
[10:30:25] ⏱️  总耗时: 10.23秒
[10:30:25] 📊 处理节点数: 6
[10:30:25] ⚡ 平均每节点: 1.71秒
[10:30:25] ================================================================================
```

## 🎉 完成后

查看生成的文件：
- `agent_outputs.md` - 详细的 Markdown 报告
- `agent_outputs.json` - 结构化的 JSON 数据

这些文件包含了每个 Agent 的完整输出和处理过程！

