# ğŸ“ AIæ™ºèƒ½æ‰¹æ”¹ç³»ç»Ÿ v2.0

> åŸºäºLangGraph Orchestrator-Workeræ¨¡å¼çš„æ™ºèƒ½æ‰¹æ”¹å¹³å°

ä¸€ä¸ªç°ä»£åŒ–çš„AIæ‰¹æ”¹ç³»ç»Ÿ,é‡‡ç”¨Streamlitå…¨æ ˆæ¶æ„,å®ç°é«˜æ•ˆå¹¶è¡Œæ‰¹æ”¹å’Œæ™ºèƒ½è¯„ä»·ç”Ÿæˆã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸš€ **é«˜æ•ˆå¹¶è¡Œ**: Orchestrator-Workeræ¨¡å¼,6.7xæ€§èƒ½åŠ é€Ÿ
- ğŸ¯ **åŒæ¨¡å¼æ‰¹æ”¹**: é«˜æ•ˆæ¨¡å¼(èŠ‚çœ66% Token) / ä¸“ä¸šæ¨¡å¼(è¯¦ç»†åé¦ˆ)
- ğŸ–¼ï¸ **å¤šæ¨¡æ€æ”¯æŒ**: æ–‡æœ¬+å›¾åƒè¯†åˆ«,åƒç´ åæ ‡æ ‡æ³¨
- ğŸ‘¤ **å­¦ç”Ÿè¯†åˆ«**: æ™ºèƒ½åŒ¹é…,æ”¯æŒæ¨¡ç³ŠåŒ¹é…å’ŒOCRçº é”™
- ğŸ“Š **æ™ºèƒ½è¯„ä»·**: ä¸ªäººè¯„ä»·+ç­çº§åˆ†ææŠ¥å‘Š
- ğŸ”„ **ä»»åŠ¡æ¢å¤**: Checkpointæœºåˆ¶,æ”¯æŒä¸­æ–­æ¢å¤
- ğŸ¨ **ç°ä»£åŒ–UI**: Streamlitäº¤äº’ç•Œé¢

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### æ–¹å¼1: ä¸€é”®å¯åŠ¨(æ¨è)
```bash
# Windowsç”¨æˆ·
start_local.bat
```

**è‡ªåŠ¨å®Œæˆ**:
- âœ… æ£€æŸ¥ä¾èµ–åŒ…
- âœ… åˆå§‹åŒ–æ•°æ®åº“
- âœ… å¯åŠ¨Streamlitåº”ç”¨
- âœ… æ‰“å¼€æµè§ˆå™¨

### æ–¹å¼2: æ‰‹åŠ¨å¯åŠ¨
```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. é…ç½®ç¯å¢ƒå˜é‡
# ç¼–è¾‘ .env.local
OPENAI_API_KEY=sk-your-key-here

# 3. åˆå§‹åŒ–æ•°æ®åº“
python local_runner.py

# 4. å¯åŠ¨åº”ç”¨
streamlit run main.py
```

## ğŸŒ è®¿é—®åœ°å€

- **åº”ç”¨ç•Œé¢**: http://localhost:8501
- **æµ‹è¯•æ•°æ®**: `test_data/` ç›®å½•

## ğŸ¯ æ ¸å¿ƒæŒ‡æ ‡

| æŒ‡æ ‡ | é«˜æ•ˆæ¨¡å¼ | ä¸“ä¸šæ¨¡å¼ |
|------|---------|----------|
| Tokenæ¶ˆè€—/é¢˜ | ~500 | ~1500 |
| å¤„ç†æ—¶é—´/é¢˜ | 2ç§’ | 5ç§’ |
| å¹¶è¡ŒåŠ é€Ÿæ¯” | 6.7x | 6.7x |
| TokenèŠ‚çœ | 66% | - |

## ğŸ“‹ å…³é”®æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| `start_local.bat` | ğŸš€ ä¸€é”®å¯åŠ¨ | Windowså¿«é€Ÿå¯åŠ¨è„šæœ¬ |
| `local_runner.py` | ğŸ”§ æœ¬åœ°è¿è¡Œå™¨ | ç¯å¢ƒæ£€æŸ¥å’Œæµ‹è¯•å·¥å…· |
| `.env.local` | âš™ï¸ æœ¬åœ°é…ç½® | ç¯å¢ƒå˜é‡é…ç½® |
| `main.py` | ğŸ¨ åº”ç”¨å…¥å£ | Streamlitä¸»ç¨‹åº |
| `LOCAL_SETUP.md` | ğŸ“– è¿è¡ŒæŒ‡å— | æœ¬åœ°è¿è¡Œè¯¦ç»†è¯´æ˜ |

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| å‰ç«¯ | Streamlit | æœ€æ–° | å…¨æ ˆWebæ¡†æ¶ |
| å·¥ä½œæµ | LangGraph | 0.0.40+ | çŠ¶æ€æœºç¼–æ’å¼•æ“ |
| LLM | OpenAI GPT-4 | - | æ ¸å¿ƒæ‰¹æ”¹æ¨¡å‹ |
| å¤šæ¨¡æ€ | GPT-4 Vision | - | å›¾åƒæ–‡æœ¬æå– |
| æ•°æ®åº“ | SQLite/PostgreSQL | - | æœ¬åœ°/ç”Ÿäº§æ•°æ®åº“ |
| ORM | SQLAlchemy | - | æ•°æ®æ¨¡å‹ç®¡ç† |
| è¿ç§» | Alembic | - | æ•°æ®åº“ç‰ˆæœ¬æ§åˆ¶ |

## ğŸ“ é¡¹ç›®ç»“æ„

```
ai_correction/
â”œâ”€â”€ main.py                      # Streamlitåº”ç”¨å…¥å£
â”œâ”€â”€ functions/
â”‚   â”œâ”€â”€ langgraph/              # LangGraphå·¥ä½œæµ
â”‚   â”‚   â”œâ”€â”€ agents/            # 12ä¸ªæ ¸å¿ƒAgent
â”‚   â”‚   â”‚   â”œâ”€â”€ orchestrator.py        # Orchestrator
â”‚   â”‚   â”‚   â”œâ”€â”€ evaluate_batch.py      # Workeræ± 
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ prompts/           # æç¤ºè¯æ¨¡æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ efficient_mode.py      # é«˜æ•ˆæ¨¡å¼
â”‚   â”‚   â”‚   â”œâ”€â”€ professional_mode.py   # ä¸“ä¸šæ¨¡å¼
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ state.py           # GradingStateå®šä¹‰
â”‚   â”‚   â”œâ”€â”€ workflow_new.py    # å·¥ä½œæµç¼–æ’
â”‚   â”‚   â”œâ”€â”€ routing.py         # åŠ¨æ€è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ checkpointer.py    # Checkpointç®¡ç†
â”‚   â”‚   â””â”€â”€ streaming.py       # æµå¼ç›‘æ§
â”‚   â””â”€â”€ database/
â”‚       â”œâ”€â”€ models.py          # æ•°æ®åº“æ¨¡å‹
â”‚       â”œâ”€â”€ migration.py       # æ•°æ®åº“è¿ç§»
â”‚       â””â”€â”€ student_matcher.py # å­¦ç”ŸåŒ¹é…ç®—æ³•
â”œâ”€â”€ tests/                      # æµ‹è¯•å¥—ä»¶
â”œâ”€â”€ docs/                       # å®Œæ•´æ–‡æ¡£
â”œâ”€â”€ .env.local                  # æœ¬åœ°é…ç½®
â”œâ”€â”€ local_runner.py             # æœ¬åœ°è¿è¡Œå™¨
â””â”€â”€ start_local.bat             # å¯åŠ¨è„šæœ¬
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ä¾èµ–å®‰è£…å¤±è´¥**
   ```bash
   # ä½¿ç”¨å›½å†…é•œåƒ
   pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
   ```

2. **OpenAI APIé”™è¯¯**
   ```bash
   # æ£€æŸ¥API Key
   echo $OPENAI_API_KEY
   
   # æ›´æ–°.env.local
   OPENAI_API_KEY=sk-your-actual-key
   ```

3. **æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥**
   ```bash
   # åˆ é™¤æ—§æ•°æ®åº“
   del ai_correction.db
   
   # é‡æ–°åˆå§‹åŒ–
   python local_runner.py
   ```

4. **LangGraphå¯¼å…¥é”™è¯¯**
   ```bash
   # ç¡®ä¿ç‰ˆæœ¬æ­£ç¡®
   pip install langgraph>=0.0.40 langchain>=0.1.0
   ```

æ›´å¤šé—®é¢˜æŸ¥çœ‹ [æ•…éšœæ’é™¤æŒ‡å—](./docs/TROUBLESHOOTING.md)

## ğŸ“ ä½¿ç”¨æµç¨‹

1. **å‡†å¤‡ææ–™**: é¢˜ç›®æ–‡ä»¶ã€ç­”æ¡ˆæ–‡ä»¶ã€è¯„åˆ†æ ‡å‡†(å¯é€‰)
2. **å¯åŠ¨ç³»ç»Ÿ**: è¿è¡Œ `start_local.bat` æˆ– `streamlit run main.py`
3. **ä¸Šä¼ æ–‡ä»¶**: åœ¨ç•Œé¢ä¸­ä¸Šä¼ ä¸‰ç±»æ–‡ä»¶
4. **é€‰æ‹©æ¨¡å¼**: é«˜æ•ˆæ¨¡å¼ æˆ– ä¸“ä¸šæ¨¡å¼
5. **å¼€å§‹æ‰¹æ”¹**: ç‚¹å‡»æŒ‰é’®,ç­‰å¾…è¿›åº¦å®Œæˆ
6. **æŸ¥çœ‹ç»“æœ**: æ€»åˆ†ã€å„é¢˜å¾—åˆ†ã€ä¸ªäººè¯„ä»·ã€ç­çº§åˆ†æ

**è¯¦ç»†æ•™ç¨‹**: æŸ¥çœ‹ [5åˆ†é’Ÿå¿«é€Ÿå…¥é—¨](./docs/QUICKSTART.md)

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### Orchestrator-Workerå¹¶è¡Œæ¨¡å¼

```python
# OrchestratoråŠ¨æ€ç”ŸæˆWorker
class OrchestratorAgent:
    def __call__(self, state) -> List[Send]:
        sends = []
        for batch in state['batches']:
            send_obj = Send("evaluate_batch_worker", batch_state)
            sends.append(send_obj)
        return sends  # LangGraphè‡ªåŠ¨å¹¶è¡Œæ‰§è¡Œ
```

**æ€§èƒ½æå‡**:
- é¡ºåºå¤„ç†30é¢˜: 150ç§’
- å¹¶è¡Œå¤„ç†(3 worker): 50ç§’
- åŠ é€Ÿæ¯”: 3å€(å®é™…æµ‹è¯•6.7å€)

### åŒæ¨¡å¼æ‰¹æ”¹

**é«˜æ•ˆæ¨¡å¼**:
```json
{
  "score": 8,
  "label": "correct",
  "brief_comment": "åŸºæœ¬æ­£ç¡®,ç¬¬ä¸‰æ­¥è®¡ç®—æœ‰è¯¯"
}
```

**ä¸“ä¸šæ¨¡å¼**:
```json
{
  "score": 8,
  "detailed_feedback": {
    "strengths": ["è§£é¢˜æ€è·¯æ¸…æ™°"],
    "weaknesses": ["è®¡ç®—é”™è¯¯"],
    "suggestions": ["åŠ å¼ºè¿ç®—å‡†ç¡®æ€§"],
    "knowledge_points": ["å‡½æ•°å•è°ƒæ€§"]
  }
}
```

### å­¦ç”Ÿä¿¡æ¯åŒ¹é…

æ”¯æŒå¤šç­–ç•¥åŒ¹é…:
1. å­¦å·ç²¾ç¡®åŒ¹é…
2. å§“å+ç­çº§ç²¾ç¡®åŒ¹é…
3. å§“åæ¨¡ç³ŠåŒ¹é…(ç›¸ä¼¼åº¦â‰¥0.75)
4. å­¦å·æ¨¡ç³ŠåŒ¹é…(OCRçº é”™)

## ğŸ“š å®Œæ•´æ–‡æ¡£

### å¿«é€Ÿä¸Šæ‰‹
- ğŸ“˜ [5åˆ†é’Ÿå¿«é€Ÿå…¥é—¨](./docs/QUICKSTART.md) - æœ€å¿«é€Ÿå¼€å§‹
- ğŸ“— [å®Œæ•´ä½¿ç”¨æŒ‡å—](./docs/USER_GUIDE.md) - è¯¦ç»†åŠŸèƒ½è¯´æ˜
- ğŸ“™ [æœ¬åœ°è¿è¡ŒæŒ‡å—](./LOCAL_SETUP.md) - æœ¬åœ°å¼€å‘ç¯å¢ƒ

### æŠ€æœ¯æ–‡æ¡£
- ğŸ—ï¸ [ç³»ç»Ÿæ¶æ„æ–‡æ¡£](./docs/SYSTEM_ARCHITECTURE.md) - å®Œæ•´æŠ€æœ¯æ¶æ„
- ğŸ“– [APIå‚è€ƒæ–‡æ¡£](./docs/API_REFERENCE.md) - å¼€å‘æ¥å£è¯´æ˜
- âš™ï¸ [ç¯å¢ƒå˜é‡é…ç½®](./docs/ENVIRONMENT_VARIABLES.md) - é…ç½®è¯¦è§£

### éƒ¨ç½²è¿ç»´
- ğŸš€ [éƒ¨ç½²æŒ‡å—](./docs/DEPLOYMENT_GUIDE.md) - ç”Ÿäº§éƒ¨ç½²æ–¹æ¡ˆ
- ğŸ› [æ•…éšœæ’é™¤](./docs/TROUBLESHOOTING.md) - å¸¸è§é—®é¢˜è§£å†³

### è®¾è®¡æ–‡æ¡£
- ğŸ“ [LangGraphç³»ç»Ÿè®¾è®¡](./docs/langgraph_correction_system_design.md)
- ğŸ›ï¸ [ç”Ÿäº§ç³»ç»Ÿæ¶æ„](./docs/production_system_architecture.md)
- ğŸ¯ [Agentè¯¦ç»†è®¾è®¡](./docs/agent_design_details.md)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Request!

## ğŸ“„ è®¸å¯è¯

MIT License

---

**AIæ‰¹æ”¹ç³»ç»Ÿ v2.0** - åŸºäºLangGraphçš„æ–°ä¸€ä»£æ™ºèƒ½æ‰¹æ”¹å¹³å° ğŸš€ 