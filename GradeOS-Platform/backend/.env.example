# GradeOS Backend 环境变量配置

# ============ 部署模式 ============
# 支持两种部署模式：
# 1. 数据库模式：设置 DATABASE_URL 和 REDIS_URL（完整功能）
# 2. 无数据库模式：不设置或留空 DATABASE_URL（轻量级部署）
#
# 无数据库模式特点：
# - 仅需 LLM API Key
# - 使用内存缓存
# - 无需 PostgreSQL 和 Redis
# - 适合测试和小规模使用
# - 详见: docs/NO_DATABASE_MODE.md

# ============ 数据库配置 ============
# 方式一：使用完整连接字符串（数据库模式）
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/ai_grading


# 连接池配置
DB_POOL_MIN_SIZE=2
DB_POOL_MAX_SIZE=10

# ============ Redis 配置 ============
# 数据库模式需要，无数据库模式可选
REDIS_URL=redis://localhost:6379



# ============ AI 模型配置 ============
# OpenRouter API
LLM_API_KEY=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
LLM_BASE_URL=https://openrouter.ai/api/v1

# Force provider (optional): openrouter
LLM_PROVIDER=openrouter

# OpenRouter 模型配置
LLM_DEFAULT_MODEL=google/gemini-3-flash-preview
LLM_TEXT_MODEL=google/gemini-3-flash-preview
LLM_VISION_MODEL=google/gemini-3-flash-preview
LLM_RUBRIC_MODEL=google/gemini-3-flash-preview
LLM_SUMMARY_MODEL=google/gemini-3-flash-preview

# ============ 安全配置 ============
# JWT 密钥 (生产环境请使用强随机字符串)
JWT_SECRET=your_jwt_secret_key_here
JWT_ALGORITHM=HS256
JWT_EXPIRE_HOURS=24

# ============ 应用配置 ============
# 环境: development / production
ENVIRONMENT=development

# 日志级别: DEBUG / INFO / WARNING / ERROR
LOG_LEVEL=DEBUG

# CORS 允许的源 (逗号分隔)
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# ============ 文件存储 ============
# 上传文件存储路径
UPLOAD_DIR=./uploads

# 最大文件大小 (MB)
MAX_FILE_SIZE_MB=50

# ============ 批改配置 ============
# 批量批改并发数
BATCH_CONCURRENCY=5
GRADING_MAX_WORKERS=5
TEACHER_MAX_ACTIVE_RUNS=3

# 单次批改超时 (秒)
GRADING_TIMEOUT=120

# 严格评分保护开关（默认开启）
STRICT_GRADING_GUARD=true

# Rubric review toggle (default: true)
RUBRIC_REVIEW_ENABLED=true
# Rubric parsing batch size
RUBRIC_PARSE_BATCH_SIZE=20
# Rubric parsing concurrency
RUBRIC_PARSE_CONCURRENCY=3

# ============ 逻辑复核配置 ============
# 逻辑复核开关（默认开启）
LOGIC_REVIEW_ENABLED=true

# 逻辑复核模式：worker（每个批改 Worker 独立复核）/global（全局汇总复核）
LOGIC_REVIEW_MODE=worker

# 最大复核题目数（防止过度消耗）
LOGIC_REVIEW_MAX_QUESTIONS=999

# 是否携带原始作答图片参与复核
LOGIC_REVIEW_WITH_IMAGES=true

# 每道题最多携带的图片数量
LOGIC_REVIEW_MAX_IMAGES_PER_QUESTION=2

# 每次复核调用包含的题目数量
LOGIC_REVIEW_BATCH_SIZE=5
# 逻辑复核并发数
LOGIC_REVIEW_CONCURRENCY=3

# ============ 缓存配置 ============
# 缓存 TTL (秒)
CACHE_TTL_DEFAULT=300
CACHE_TTL_USER=3600
CACHE_TTL_CLASS=1800

