# Railway éƒ¨ç½²ç›‘æ§æŠ¥å‘Š

## ğŸ“Š éƒ¨ç½²çŠ¶æ€æ€»ç»“

### âœ… ä»£ç å·²æ¨é€åˆ° GitHub
- **æäº¤ä¿¡æ¯**: fix: ä¿®å¤Railwayæ‰¹æ”¹æµç¨‹é—®é¢˜ - æ—¥å¿—æ··ä¹±ã€é¢˜ç›®æ•°é‡é”™è¯¯ã€å¢å¼ºè°ƒè¯•èƒ½åŠ›
- **æäº¤å“ˆå¸Œ**: c3128cc
- **æ¨é€æ—¶é—´**: 2026-01-31 18:52 GMT+8
- **åˆ†æ”¯**: main

### ğŸš€ Railway è‡ªåŠ¨éƒ¨ç½²å·²è§¦å‘
- **é¡¹ç›®**: GradeOS
- **ç¯å¢ƒ**: production
- **æœåŠ¡**: 
  - âœ… backend (gradeos-production.up.railway.app)
  - âœ… frontend (gradeos.up.railway.app)
  - âœ… Postgres (æ•°æ®åº“)
  - âœ… Redis (ç¼“å­˜)

### ğŸ“ ä¿®å¤å†…å®¹

#### 1. æ—¥å¿—æ··ä¹±é—®é¢˜ âœ…
**æ–‡ä»¶**: `backend/src/graphs/batch_grading.py`

**ä¿®å¤å‰**:
```python
logger.info(f"[rubric_parse] {json.dumps(parsed_rubric, ensure_ascii=False, indent=2)}")
```

**ä¿®å¤å**:
```python
if logger.isEnabledFor(logging.DEBUG):
    logger.debug(f"[rubric_parse] {json.dumps(parsed_rubric, ensure_ascii=False, indent=2)}")
else:
    question_ids = [q.get('question_id', '?') for q in parsed_rubric.get('questions', [])]
    logger.info(f"[rubric_parse] é¢˜ç›®åˆ—è¡¨: {', '.join(question_ids)}")
```

**æ•ˆæœ**: ç”Ÿäº§ç¯å¢ƒæ—¥å¿—ä¸å†è¾“å‡ºå¤§é‡ JSON,åªæ˜¾ç¤ºé¢˜ç›®åˆ—è¡¨

#### 2. é¢˜ç›®æ•°é‡é”™è¯¯ âœ…
**æ–‡ä»¶**: `backend/src/services/rubric_parser.py`

**ä¿®å¤å‰**:
```python
{
  "total_questions_found": å®é™…è¯†åˆ«åˆ°çš„é¢˜ç›®æ•°é‡,  # âŒ å¯¼è‡´ LLM é‡å¤è®¡æ•°
  ...
}
```

**ä¿®å¤å**:
```python
{
  # âœ… ç§»é™¤äº† total_questions_found å­—æ®µ
  "overall_parse_confidence": 0.0-1.0ä¹‹é—´çš„æ•°å€¼,
  ...
}
```

**æ•ˆæœ**: é¢˜ç›®æ•°é‡ç”±ä»£ç è®¡ç®—,é¿å… LLM é”™è¯¯è®¡æ•°

#### 3. å¢å¼ºè°ƒè¯•èƒ½åŠ› âœ…
**æ–‡ä»¶**: `backend/src/graphs/batch_grading.py`

**æ–°å¢æ—¥å¿—**:
```python
# åœ¨ grading_fanout_router ä¸­:
if not processed_images:
    logger.warning(f"[grading_fanout] âš ï¸ æ²¡æœ‰å¾…æ‰¹æ”¹çš„å›¾åƒ")
    logger.warning(f"[grading_fanout] ğŸ” è°ƒè¯•: state keys={list(state.keys())}")
    logger.warning(f"[grading_fanout] ğŸ” processed_images count={len(state.get('processed_images', []))}")

if sends:
    logger.info(f"[grading_fanout] âœ… æˆåŠŸåˆ›å»º {len(sends)} ä¸ªå­¦ç”Ÿæ‰¹æ”¹ä»»åŠ¡")
else:
    logger.warning(f"[grading_fanout] âš ï¸ æ²¡æœ‰æœ‰æ•ˆçš„å­¦ç”Ÿæ‰¹æ¬¡")
    logger.warning(f"[grading_fanout] ğŸ” student_boundaries={student_boundaries}")
```

**æ•ˆæœ**: æ›´å®¹æ˜“è¯Šæ–­æ‰¹æ”¹æµç¨‹é—®é¢˜

### ğŸ” å¾…éªŒè¯çš„é—®é¢˜

#### é—®é¢˜ 3: æµç¨‹æå‰ç»“æŸ
**çŠ¶æ€**: ğŸŸ¡ éœ€è¦å®é™…æµ‹è¯•éªŒè¯

**å¯èƒ½åŸå› **:
1. `processed_images` ä¸ºç©º
2. `student_boundaries` é…ç½®é”™è¯¯
3. æ‰¹æ”¹ä»»åŠ¡åˆ›å»ºå¤±è´¥

**éªŒè¯æ–¹æ³•**:
1. ä¸Šä¼ æ‰¹æ”¹ä»»åŠ¡
2. æŸ¥çœ‹ Railway æ—¥å¿—ä¸­çš„ `[grading_fanout]` ç›¸å…³ä¿¡æ¯
3. ç¡®è®¤æ˜¯å¦çœ‹åˆ° "âœ… æˆåŠŸåˆ›å»º X ä¸ªå­¦ç”Ÿæ‰¹æ”¹ä»»åŠ¡"

#### é—®é¢˜ 4: æ‰¹æ”¹ç»“æœé¡µç©ºç™½
**çŠ¶æ€**: ğŸŸ¡ ä¾èµ–é—®é¢˜ 3 çš„è§£å†³

**å¯èƒ½åŸå› **:
- å¦‚æœæ‰¹æ”¹æµç¨‹æ²¡æœ‰æ‰§è¡Œ,å°±ä¸ä¼šæœ‰ç»“æœæ•°æ®

**éªŒè¯æ–¹æ³•**:
1. ç¡®è®¤æ‰¹æ”¹æµç¨‹æ­£å¸¸æ‰§è¡Œ
2. æ£€æŸ¥ `student_results` æ˜¯å¦æ­£ç¡®èšåˆ
3. æŸ¥çœ‹å‰ç«¯ API è°ƒç”¨æ˜¯å¦æˆåŠŸ

### ğŸ“‹ æµ‹è¯•æ­¥éª¤

#### 1. ç­‰å¾…éƒ¨ç½²å®Œæˆ
- å½“å‰çŠ¶æ€: ğŸ”„ æ„å»ºä¸­
- é¢„è®¡æ—¶é—´: 2-3 åˆ†é’Ÿ
- æ£€æŸ¥æ–¹æ³•: Railway Dashboard æ˜¾ç¤º "Online"

#### 2. æµ‹è¯•æ‰¹æ”¹æµç¨‹
```
1. è®¿é—® https://gradeos.up.railway.app
2. ç™»å½•ç³»ç»Ÿ
3. ä¸Šä¼ æ‰¹æ”¹ä»»åŠ¡:
   - 19 é¡µç­”é¢˜å›¾åƒ
   - æ‰¹æ”¹æ ‡å‡†å›¾åƒ
4. è§‚å¯Ÿæ‰¹æ”¹æµç¨‹
```

#### 3. æ£€æŸ¥ Railway æ—¥å¿—
æŸ¥æ‰¾ä»¥ä¸‹å…³é”®ä¿¡æ¯:

âœ… **æ­£å¸¸æ—¥å¿—**:
```
[rubric_parse] é¢˜ç›®åˆ—è¡¨: 1, 2, 3, ..., 19
[rubric_parse] è¯„åˆ†æ ‡å‡†è§£ææˆåŠŸ: é¢˜ç›®æ•°=19, æ€»åˆ†=105
[grading_fanout] âœ… æˆåŠŸåˆ›å»º X ä¸ªå­¦ç”Ÿæ‰¹æ”¹ä»»åŠ¡
[grade_batch] å¼€å§‹æ‰¹æ”¹æ‰¹æ¬¡ 1/X
```

âŒ **å¼‚å¸¸æ—¥å¿—**:
```
[grading_fanout] âš ï¸ æ²¡æœ‰å¾…æ‰¹æ”¹çš„å›¾åƒ
[grading_fanout] âš ï¸ æ²¡æœ‰æœ‰æ•ˆçš„å­¦ç”Ÿæ‰¹æ¬¡
[grading_fanout] ğŸ” processed_images count=0
```

#### 4. éªŒè¯ç»“æœ
- âœ… é¢˜ç›®æ•°é‡æ˜¾ç¤ºæ­£ç¡® (19 é¢˜)
- âœ… æ—¥å¿—è¾“å‡ºæ¸…æ™° (æ— å¤§é‡ JSON)
- âœ… æ‰¹æ”¹æµç¨‹æ­£å¸¸æ‰§è¡Œ
- âœ… æ‰¹æ”¹ç»“æœæ­£ç¡®æ˜¾ç¤º

### ğŸ› ï¸ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

#### åœºæ™¯ 1: é¢˜ç›®æ•°é‡ä»ç„¶é”™è¯¯
1. æ£€æŸ¥ Railway æ—¥å¿—ä¸­çš„ `[rubric_parse] é¢˜ç›®åˆ—è¡¨`
2. å¦‚æœä»ç„¶é”™è¯¯,å¯èƒ½æ˜¯ LLM è§£æé—®é¢˜
3. å°è¯•è°ƒæ•´ `RUBRIC_PARSE_MAX_PAGES` ç¯å¢ƒå˜é‡

#### åœºæ™¯ 2: æµç¨‹ä»ç„¶æå‰ç»“æŸ
1. æŸ¥æ‰¾ `[grading_fanout] ğŸ”` è°ƒè¯•æ—¥å¿—
2. æ£€æŸ¥ `processed_images count` æ˜¯å¦ä¸º 0
3. æ£€æŸ¥ `student_boundaries` æ˜¯å¦ä¸ºç©º
4. å°†å®Œæ•´æ—¥å¿—å‘é€ç»™å¼€å‘å›¢é˜Ÿåˆ†æ

#### åœºæ™¯ 3: æ‰¹æ”¹ç»“æœä»ç„¶ç©ºç™½
1. ç¡®è®¤æ˜¯å¦çœ‹åˆ° `[grade_batch] å¼€å§‹æ‰¹æ”¹æ‰¹æ¬¡` æ—¥å¿—
2. æ£€æŸ¥å‰ç«¯ API è°ƒç”¨æ˜¯å¦æˆåŠŸ
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

### ğŸ“ è”ç³»æ”¯æŒ

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨,è¯·æä¾›:
1. Railway å®Œæ•´æ—¥å¿— (ä»ä¸Šä¼ åˆ°ç»“æœé¡µ)
2. æ‰¹æ”¹æ ‡å‡†å›¾åƒ (è„±æ•å)
3. ç­”é¢˜å›¾åƒæ•°é‡
4. é¢„æœŸé¢˜ç›®æ•°é‡å’Œæ€»åˆ†
5. æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-31 18:52 GMT+8
**éƒ¨ç½²ç‰ˆæœ¬**: c3128cc
**ç›‘æ§å·¥å…·**: Chrome DevTools MCP
