# GradeOS Platform

> **GradeOS** 是一个基于 AI 的智能批改平台，采用视觉原生的 PDF 处理技术，支持评分点驱动的精准批改。

## 🎯 核心功能

- 🤖 **AI 批改引擎** - 基于 Google Gemini 3.0 Flash 的视觉原生批改
- 📊 **评分点驱动** - 不是简单的对错判断，而是基于评分标准的逐点评分
- 🔍 **证据绑定** - 每个评分点都有对应的原文证据
- ⚡ **实时批改** - WebSocket 实时推送批改进度
- 📁 **批量处理** - 支持整个班级的批量批改

## 🚀 快速开始

### 5 分钟启动（无数据库模式）

```bash
# 1. 克隆项目
git clone https://github.com/your-org/GradeOS-Platform.git
cd GradeOS-Platform

# 2. 后端启动
cd backend
pip install -r requirements.txt
export LLM_API_KEY="your-gemini-api-key"
uvicorn src.api.main:app --reload --port 8001

# 3. 前端启动（新终端）
cd ../frontend
npm install
npm run dev
```

访问 http://localhost:3000 开始使用！

## ⚙️ 环境配置

### 方式一：快速体验（无数据库模式）

**适合场景**：快速测试、演示、单次批改

只需配置 Gemini API Key 即可启动：

```bash
# 1. 进入后端目录
cd backend

# 2. 创建环境变量文件
cp .env.example .env

# 3. 编辑 .env 文件，只需填写 API Key
# Windows: notepad .env
# Mac/Linux: nano .env
```

`.env` 文件内容（最小配置）：

```bash
# ============ 必填配置 ============
# Gemini API Key（必须）
# 注意：我们使用 OpenRouter 提供的 Gemini 模型
# API Key 由 GradeOS 开发团队提供，用户无需自行申请
GEMINI_API_KEY=your_gemini_api_key_here

# ============ 可选配置 ============
# 部署模式：no_database（默认）或 full
DEPLOYMENT_MODE=no_database
```

**关于 API Key**：
- ✅ **已提供**：GradeOS 使用 OpenRouter 平台统一调用 Gemini 模型
- ✅ **开发者配置**：API Key 由开发团队在部署时配置
- ✅ **用户无需申请**：普通用户无需自行申请 Google AI Studio 账号
- 📧 **获取方式**：如需部署，请联系开发团队获取 API Key

### 方式二：完整部署（数据库模式）

**适合场景**：生产环境、多用户、长期使用

需要配置数据库和缓存服务：

```bash
# 1. 启动数据库服务（使用 Docker）
cd backend
docker-compose up -d postgres redis

# 2. 配置环境变量
cp .env.example .env
```

`.env` 文件内容（完整配置）：

```bash
# ============ 必填配置 ============
# Gemini API Key
# 注意：我们使用 OpenRouter 提供的 Gemini 模型
# API Key 由 GradeOS 开发团队提供，用户无需自行申请
GEMINI_API_KEY=your_gemini_api_key_here

# 部署模式：full（完整模式）
DEPLOYMENT_MODE=full

# ============ 数据库配置 ============
# PostgreSQL 数据库连接
DATABASE_URL=postgresql://postgres:your_password@localhost:5432/gradeos

# Redis 缓存连接
REDIS_URL=redis://localhost:6379/0

# ============ 安全配置 ============
# JWT 密钥（用于用户认证）
JWT_SECRET=your_random_secret_key_here

# ============ 可选配置 ============
# API 端口
API_PORT=8001

# 日志级别：DEBUG, INFO, WARNING, ERROR
LOG_LEVEL=INFO

# 批改并发数（影响速度）
MAX_CONCURRENCY=5
```

**数据库初始化**：

```bash
# 运行数据库迁移
cd backend
alembic upgrade head

# 创建初始数据（可选）
python scripts/init_database.py
```

### 配置验证

启动后端服务，验证配置是否正确：

```bash
cd backend
uvicorn src.api.main:app --reload --port 8001
```

访问 http://localhost:8001/health 应该看到：

```json
{
  "status": "healthy",
  "mode": "no_database",  // 或 "full"
  "gemini_configured": true
}
```

### 常见配置问题

**Q: 我需要自己申请 Gemini API Key 吗？**
```
答：不需要。GradeOS 使用 OpenRouter 平台统一调用 Gemini 模型，
API Key 由开发团队提供和管理。如需部署，请联系开发团队获取。
```

**Q: API Key 无效？**
```
错误：Invalid API key
解决：
1. 确认使用的是开发团队提供的 OpenRouter API Key
2. 检查 GEMINI_API_KEY 是否正确复制，注意不要有多余空格
3. 联系开发团队确认 API Key 是否有效
```

**Q: 数据库连接失败？**
```
错误：could not connect to server
解决：
1. 确认 PostgreSQL 已启动：docker ps
2. 检查 DATABASE_URL 格式是否正确
3. 确认端口 5432 未被占用
```

**Q: Redis 连接失败？**
```
错误：Error connecting to Redis
解决：
1. 确认 Redis 已启动：docker ps
2. 检查 REDIS_URL 格式是否正确
3. 尝试：redis-cli ping（应返回 PONG）
```

## 📚 使用指南

### 1. 启动系统

```bash
# 后端
cd backend
uvicorn src.api.main:app --reload --port 8001

# 前端
cd frontend
npm run dev
```

访问 http://localhost:3000 进入 GradeOS 平台

### 2. 教师使用指南

#### 2.1 注册与登录

1. **访问平台**
   - 打开 http://localhost:3000
   - 点击"教师登录"

2. **注册账号**
   - 填写教师信息：姓名、邮箱、密码
   - 选择学校和学科
   - 完成邮箱验证

3. **登录系统**
   - 输入邮箱和密码
   - 进入教师工作台

#### 2.2 班级管理

1. **创建班级**
   ```
   教师工作台 → 班级管理 → 创建班级
   - 班级名称：如"高一(3)班数学"
   - 学科：选择对应学科
   - 学期：2024-2025学年上学期
   - 生成班级邀请码
   ```

2. **管理学生**
   ```
   班级详情 → 学生管理
   - 查看学生列表
   - 添加/删除学生
   - 导出学生名单
   - 分享班级邀请码
   ```

3. **班级设置**
   ```
   - 修改班级信息
   - 设置批改偏好
   - 配置评分标准
   ```

#### 2.3 作业发布与管理

1. **创建作业**
   ```
   作业管理 → 发布作业
   - 作业标题：如"第三章函数练习"
   - 截止时间：设置提交截止日期
   - 上传标准答案PDF
   - 设置评分标准    人机交互 
   - 选择目标班级
   ```

2. **作业设置**
   ```
   高级设置：
   - 批改模式：标准/严格
   - 逻辑复核：开启/关闭
   - 另类解法：允许/不允许
   - 分数公开：立即/批改完成后
   ```

3. **作业监控**
   ```
   作业详情页面：
   - 提交进度：已提交/未提交学生
   - 批改状态：待批改/批改中/已完成
   - 实时统计：平均分、分数分布
   ```

#### 2.4 AI 批改操作

GradeOS 提供两种批改模式，满足不同场景需求：

##### 2.4.1 半自动批改模式（推荐用于重要考试）

**适用场景**：期中/期末考试、重要测验、强主观的长答作业

**操作流程**：

1. **启动批改**
   ```
   作业管理 → 选择作业 → 半自动批改
   - 上传标准答案PDF
   - 设置评分标准
   - 选择批改模式：半自动
   - 点击"开始AI批改"
   ```

2. **AI初步批改**
   ```
   系统自动完成：
   - 识别学生答案内容
   - 对照评分标准逐点评分
   - 生成初步评分结果
   - 标注不确定项（置信度<80%）
   ```

3. **教师审核与调整**
   ```
   批改审核界面：
   - 查看AI评分结果和依据
   - 重点审核标注项
   - 调整评分（如需要）
   - 添加个性化评语
   - 标记典型错误案例
   ```

4. **批量确认发布**
   ```
   审核完成后：
   - 预览整体成绩分布
   - 批量确认无误的评分
   - 发布成绩给学生
   - 生成批改报告
   ```

**优势**：
- ✅ 保证评分准确性和公平性
- ✅ 教师可介入关键评分决策
- ✅ 适合高风险评估场景
- ✅ 节省80%批改时间

##### 2.4.2 全自动批改模式（推荐用于客观题、填空题等得分点较明确的题目）

**适用场景**：日常练习、课后作业、周测、快速反馈场景

**操作流程**：

1. **一键启动**
   ```
   作业管理 → 选择作业 → 全自动批改
   - 确认已上传标准答案
   - 选择批改模式：全自动
   - 设置自动发布：是/否
   - 点击"开始批改"
   ```

2. **全程自动化**
   ```
   系统自动完成：
   - 批量识别所有学生答案
   - AI评分和生成评语
   - 错误分析和分类
   - 生成学习建议
   - 自动发布成绩（可选）
   ```

3. **实时监控**
   ```
   批改控制台：
   - 实时进度条（已完成/总数）
   - 当前批改学生姓名
   - 预计剩余时间
   - 批改速度统计
   - 错误日志查看
   ```

4. **结果查看**
   ```
   批改完成后：
   - 自动生成班级成绩报告
   - 查看整体统计数据
   - 下载批改结果Excel
   - 学生端自动收到反馈
   ```

**优势**：
- ⚡ 极速批改，5分钟完成全班
- 🤖 ai解放教师时间
- 📊 即时反馈，学生快速获得结果
- 🔄 适合高频次作业场景

##### 2.4.3 批改参数设置

**通用参数**：
```
批改模式选择：
├── 标准模式：平衡准确性和速度（推荐）
├── 严格模式：更严格的评分标准
└── 宽松模式：鼓励性评分，适合低年级

高级设置：
├── 并发数：3-5（影响批改速度）
├── 逻辑复核：开启/关闭（提高准确性）
├── 另类解法：允许/不允许
└── 置信度阈值：60%-90%（半自动模式）
```

**模式对比**：

| 特性 | 半自动批改 | 全自动批改 |
|------|-----------|-----------|
| 批改速度 | 中等（需人工审核） | 极快（无需等待） |
| 准确性 | 最高（人工复核） | 高（AI评分） |
| 适用场景 | 重要考试 | 日常作业 |
| 教师工作量 | 20%原工作量 | 5%原工作量 |
| 学生反馈速度 | 1-2小时 | 5-10分钟 |
| 个性化程度 | 高（可添加评语） | 中（AI生成） |

##### 2.4.4 批改质量保障

**AI评分可信度指标**：    
```
置信度显示：
- 🟢 高置信度（>85%）：直接采用
- 🟡 中置信度（70-85%）：建议复核
- 🔴 低置信度（<70%）：需人工判断

质量检查机制：
- 自动检测异常评分
- 对比历史数据合理性
- 多轮逻辑一致性验证
- 疑难题目自动标注
```


#### 2.5 成绩分析与反馈

1. **成绩统计**
   ```
   数据分析 → 成绩统计
   - 班级平均分趋势
   - 学生个人成长曲线
   - 知识点掌握情况
   - 错误类型分析
   ```

2. **生成报告**
   ```
   报告中心：
   - 班级成绩报告
   - 个人学习报告
   - 知识点分析报告
   - 导出PDF/Excel格式
   ```

3. **学生反馈**
   ```
   - 发布成绩和评语
   - 推送学习建议
   - 安排针对性练习
   -AI助手的学生知识掌握情况


   

#### 2.6 评分点驱动批改

```
传统批改：对/错 → 给分/不给分
GradeOS批改：
1. 理解评分标准
2. 逐点对照检查
3. 提供证据支撑
4. 汇总得出总分

示例：
题目：解方程 x + y = 10, x - y = 2

评分点分析：
├── 评分点1：正确列出方程组 (3分) ✅
│   证据："根据题意得：x + y = 10, x - y = 2"
├── 评分点2：选择合适解法 (2分) ✅  
│   证据："采用加减消元法"
├── 评分点3：计算过程正确 (3分) ⚠️ 部分得分(2分)
│   证据："计算中有小错误，但思路正确"
└── 评分点4：答案正确 (2分) ❌
    证据："最终答案错误"

总分：7/10分
```

#### 2.7 智能错误分析

```
错误类型自动识别：
- 概念理解错误
- 计算失误
- 方法选择不当
- 步骤遗漏
- 表达不规范

针对性建议：
- 知识点复习建议
- 练习题推荐
- 学习方法指导
```

#### 2.8 多维度数据分析

```
教师视角：
- 班级整体表现
- 知识点掌握情况
- 教学效果评估
- 个别学生关注

学生视角：
- 个人成长轨迹
- 薄弱环节识别
- 学习建议获取
- 同伴对比分析
```
### 2.9 批改控制台使用

#### 2.9.1 快速批改（单次使用）

```bash
访问批改控制台：http://localhost:3000/console

操作步骤：
1. 上传标准答案PDF
2. 上传学生作答PDF
3. 设置批改参数：
   - 批改模式：标准/严格
   - 并发数：3-5（推荐）
   - 逻辑复核：开启
4. 点击"开始批改"
5. 实时查看进度
6. 下载批改结果
```

#### 2.9.2 批改参数说明

```
批改模式：
- 标准模式：平衡准确性和速度
- 严格模式：更严格的评分标准

并发设置：
- 并发数越高，批改越快
- 建议根据网络情况设置3-5

逻辑复核：
- 开启：AI会二次检查评分逻辑
- 关闭：仅进行一次评分（更快）
```


### 3. 学生使用指南

#### 3.1 注册与加入班级

1. **注册学生账号**
   ```
   首页 → 学生注册
   - 学生姓名
   - 学号（可选）
   - 邮箱地址
   - 设置密码
   ```

2. **加入班级**
   ```
   学生工作台 → 加入班级
   - 输入教师提供的班级邀请码
   - 确认班级信息
   - 成功加入班级
   ```

3. **完善个人信息**
   ```
   个人中心 → 基本信息
   - 上传头像
   - 填写联系方式
   ```

#### 3.2 作业提交

1. **查看作业列表**
   ```
   我的作业 → 待完成作业
   - 作业标题和要求
   - 截止时间倒计时
   - 完成状态标识
   ```

2. **提交作业**
   ```
   作业详情 → 提交作业
   - 上传作答PDF文件
   - 确认文件清晰度
   - 添加备注说明（可选）
   - 点击"提交作业"
   ```

3. **修改提交**
   ```
   截止时间前可以：
   - 重新上传文件
   - 修改备注说明
   - 查看提交历史
   ```

#### 3.3 查看批改结果

1. **成绩查看**
   ```
   我的成绩 → 选择作业
   - 总分和各题得分
   - 评分点详细分析
   - 教师评语和建议
   ```

2. **错误分析**
   ```
   批改详情页面：
   - 逐题错误标注
   - 失分原因说明
   - 正确答案对比
   - 改进建议
   ```

3. **学习报告**
   ```
   个人中心 → 学习报告
   - 成绩趋势图表
   - 知识点掌握雷达图
   - 错误类型统计
   - 学习建议推荐
   ```

#### 3.4 **AI助手界面**
   ```
   助手功能：
   - 聊天窗口：与AI进行学习对话
   - 错题本：自动收集和分类错题
   - 学习计划：个性化学习建议
   - 知识图谱：相关知识点展示
   ```

1. **智能问答**
   ```
   学习助手 → 智能问答
   - 提问学习疑难
   - 获得详细解答
   - 相关知识点推荐
   ```

2. **错题复习**
   ```
   错题本功能：
   - 自动收集错题
   - 分类整理错误
   - 定期复习提醒
   - 相似题目练习
   ```

## 🌐 网站界面导航

### 主要页面结构

```
GradeOS 平台
├── 首页 (/)
│   ├── 平台介绍
│   ├── 功能特色展示
│   └── 登录/注册入口
│
├── 教师端 (/teacher)
│   ├── 教师工作台 (/teacher/dashboard)
│   │   ├── 班级概览
│   │   ├── 待处理任务
│   │   └── 数据统计
│   ├── 班级管理 (/teacher/class)
│   │   ├── 班级列表
│   │   ├── 学生管理
│   │   └── 班级设置
│   ├── 作业管理 (/teacher/homework)
│   │   ├── 发布作业
│   │   ├── 作业列表
│   │   └── 批改管理
│   └── 数据分析 (/teacher/statistics)
│       ├── 成绩统计
│       ├── 学习分析
│       └── 报告生成
│
├── 学生端 (/student)
│   ├── 学生工作台 (/student/dashboard)
│   │   ├── 我的课程
│   │   ├── 待完成作业
│   │   └── 最新成绩
│   ├── 作业中心 (/student/homework)
│   │   ├── 作业列表
│   │   ├── 提交作业
│   │   └── 历史记录
│   ├── 成绩查看 (/student/grades)
│   │   ├── 成绩列表
│   │   ├── 详细分析
│   │   └── 错题复习
│   ├── AI助手 (/student/assistant)
│   │   ├── 智能问答
│   │   ├── 学习规划
│   │   └── 错题分析
│   └── 学习报告 (/student/report)
│       ├── 成长轨迹
│       ├── 能力雷达
│       └── 学习建议
│
└── 批改控制台 (/console)
    ├── 文件上传区
    ├── 参数设置面板
    ├── 批改进度监控
    └── 结果展示区域
```


### 移动端适配

```
响应式设计：
- 手机端：垂直布局，大按钮设计
- 平板端：双栏布局，触控优化
- 桌面端：多栏布局，鼠标交互

主要适配功能：
- 作业提交：支持手机拍照上传
- 成绩查看：触控滑动查看详情
- 消息通知：推送作业和成绩提醒
```




## 🔌 主要 API

| 接口 | 方法 | 描述 |
|------|------|------|
| `/health` | GET | 系统健康检查 |
| `/batch/grade-cached` | POST | 开始批改任务 |
| `/batch/{batch_id}/results` | GET | 获取批改结果 |
| `/batch/ws/{batch_id}` | WS | 实时进度推送 |



## ❓ 常见问题

**Q: API Key 无效？**
A: 检查是否在 Google AI Studio 中正确创建并复制了 API Key

**Q: 批改速度慢？**
A: 增加并发数 `concurrency=5` 或禁用逻辑复核 `enable_logic_review=false`

**Q: 结果不准确？**
A: 确保 PDF 文件清晰完整，可尝试启用严格模式 `strict_grading=true`

## 📞 技术支持

- **GitHub Issues**: [提交问题](https://github.com/your-org/GradeOS-Platform/issues)

---

**🎉 开始你的 AI 批改之旅吧！**